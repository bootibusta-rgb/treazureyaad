<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treazure Yaad ‚Äî Cars, Homes, Rentals & More</title>
    <!-- Favicon - Treasure Chest -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%239333ea' rx='15' width='100' height='100'/><text x='50' y='68' font-size='50' text-anchor='middle'>üíé</text></svg>">
    <link rel="stylesheet" href="/index.css" />
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-brand">
            <a href="#" class="navbar-logo">
                <img src="public/treazure-yaad-logo.svg" alt="Treazure Yaad" class="navbar-logo-img" />
            </a>
        </div>
        <div class="navbar-links">
            <button class="navbar-link" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" onclick="openModal('postListing')">+ Post Listing</button>
            <!-- Show these when logged out -->
            <div id="logged-out-links">
                <button class="navbar-link" onclick="openModal('signup')">Sign Up</button>
                <button class="navbar-link" onclick="openModal('login')">Login</button>
            </div>
            <!-- Show these when logged in -->
            <div id="logged-in-links" style="display: none;">
                <button class="navbar-link" onclick="goToDashboard()">üìä Dashboard</button>
                <div class="navbar-online-status" id="navbar-online-status">
                    <span class="online-dot online" id="navbar-online-dot"></span>
                    <span class="online-text online" id="navbar-online-text">Online</span>
                </div>
                <span class="user-badge" id="user-badge">üë§ John</span>
                <button class="navbar-link" style="background: #ef4444;" onclick="logout()">Logout</button>
            </div>
            <button class="pro-badge-nav" id="pro-badge-nav" onclick="openModal('pricing')">
                <span id="pro-icon">üîí</span>
                <span id="pro-text">Pro</span>
            </button>
        </div>
    </nav>

    <!-- Ticker Bar -->
    <div class="ticker-bar" id="ticker-bar">
        <div class="ticker-content" id="ticker-content">
            <!-- Content populated by JavaScript -->
        </div>
    </div>

    <!-- Ad Banner -->
    <div class="ad-banner">
        <p class="ad-banner-text"><span class="sponsored-text">Sponsored:</span> Get your listing seen by 100k buyers</p>
        <button class="ad-banner-btn" onclick="alert('Contact us at advertise@marketplace.com')">Advertise with us</button>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title flash-colors">Categories</h2>
            <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">
                <span class="toggle-icon">‚óÄ</span>
            </button>
        </div>
        
        <div class="category-section">
            <div class="category-section-title">Vehicles</div>
            <nav class="sidebar-nav" id="vehicles-nav"></nav>
        </div>
        
        <div class="category-section">
            <div class="category-section-title">Parts</div>
            <nav class="sidebar-nav" id="parts-nav"></nav>
        </div>
        
        <div class="category-section">
            <div class="category-section-title">Other</div>
            <nav class="sidebar-nav" id="other-nav"></nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content with-sidebar">
        <!-- Hero Section -->
        <section class="hero">
            <!-- Video Background (from backgroundAssets.json - heroVideos[0]) -->
            <div class="hero-video-container">
                <video 
                    class="hero-video" 
                    autoplay 
                    muted 
                    loop 
                    playsinline
                    poster="https://images.pexels.com/videos/7578550/pexels-photo-7578550.jpeg?w=1920"
                >
                    <source src="https://videos.pexels.com/video-files/7578550/7578550-hd_1920_1080_30fps.mp4" type="video/mp4">
                    <!-- Fallback to image if video doesn't load -->
                </video>
                <!-- Fallback image for browsers that don't support video -->
                <div class="hero-bg-image"></div>
            </div>

            <!-- Overlay for readability -->
            <div class="hero-overlay"></div>

            <!-- Live Activity Badges -->
            <div class="activity-badges">
                <div class="activity-badge badge-1">
                    <span class="activity-badge-icon">üöó</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">Tesla Model 3 Sold!</span>
                        <span class="activity-badge-sub">2 minutes ago ‚Ä¢ New York</span>
                    </div>
                </div>
                <div class="activity-badge badge-2">
                    <span class="activity-badge-icon">üè†</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">Beach Villa Purchased</span>
                        <span class="activity-badge-sub">5 minutes ago ‚Ä¢ Malibu</span>
                    </div>
                </div>
                <div class="activity-badge badge-3">
                    <span class="activity-badge-icon">üöö</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">F-150 Raptor Deal Closed</span>
                        <span class="activity-badge-sub">8 minutes ago ‚Ä¢ Dallas</span>
                    </div>
                </div>
                <div class="activity-badge badge-4">
                    <span class="activity-badge-icon">‚õµ</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">Boston Whaler Sold!</span>
                        <span class="activity-badge-sub">12 minutes ago ‚Ä¢ Miami</span>
                    </div>
                </div>
                <div class="activity-badge badge-5">
                    <span class="activity-badge-icon">‚úàÔ∏è</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">Cessna 172 Reserved</span>
                        <span class="activity-badge-sub">15 minutes ago ‚Ä¢ Van Nuys</span>
                    </div>
                </div>
                <div class="activity-badge badge-6">
                    <span class="activity-badge-icon">üèçÔ∏è</span>
                    <div class="activity-badge-text">
                        <span class="activity-badge-title">Ducati Panigale Sold!</span>
                        <span class="activity-badge-sub">18 minutes ago ‚Ä¢ Miami</span>
                    </div>
                </div>
            </div>

            <!-- Full-screen logo background -->
            <img src="public/treazure-yaad-logo.svg" alt="Treazure Yaad Background" class="hero-bg-logo" />
            
            <!-- Dark overlay for text readability -->
            <div class="hero-dark-overlay"></div>
            
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="gradient-text">Treazure Yaad</span>
                </h1>
                <p class="hero-subtitle">
                    Discover amazing deals on cars, properties, boats, and more. Join thousands of satisfied customers.
                </p>
                <div class="hero-buttons">
                    <button class="btn-primary" onclick="openModal('signup')">Get Started</button>
                    <button class="btn-secondary" onclick="scrollToSection('featured')">Explore Listings</button>
                </div>
            </div>
            <div class="floating-shapes">
                <div class="shape shape-1"></div>
                <div class="shape shape-2"></div>
                <div class="shape shape-3"></div>
            </div>
        </section>

        <!-- Trust Bar -->
        <div class="trust-bar">
            <div class="trust-badge">
                <span class="trust-icon">üîí</span>
                <span class="trust-text">Secure Payments</span>
            </div>
            <div class="trust-badge">
                <span class="trust-icon">‚ù§Ô∏è</span>
                <span class="trust-text">10,000+ Happy Users</span>
            </div>
            <div class="trust-badge">
                <span class="trust-icon">‚úì</span>
                <span class="trust-text">Verified Sellers Only</span>
            </div>
            <div class="trust-badge">
                <span class="trust-icon">üìû</span>
                <span class="trust-text">24/7 Support</span>
            </div>
        </div>

        <!-- Featured Sellers Section -->
        <section class="featured-sellers-section">
            <h2 class="section-title">Featured Sellers</h2>
            <p class="section-subtitle">Top-rated dealers you can trust</p>
            <div class="sellers-grid">
                <div class="seller-card">
                    <img class="seller-avatar" src="https://ui-avatars.com/api/?name=Marcus+D&background=a855f7&color=fff&size=80" alt="Marcus D." />
                    <div class="seller-info">
                        <div class="seller-name">Marcus D. ‚Ä¢ Kingston</div>
                        <span class="seller-badge">Verified Dealer</span>
                        <div class="seller-stats">Sold 124 cars ‚Ä¢ ‚≠ê 5.0 ‚Ä¢ Pro</div>
                    </div>
                    <div class="seller-hover">Specializes in luxury rides</div>
                </div>
                <div class="seller-card">
                    <img class="seller-avatar" src="https://ui-avatars.com/api/?name=Sarah+J&background=3b82f6&color=fff&size=80" alt="Sarah J." />
                    <div class="seller-info">
                        <div class="seller-name">Sarah J. ‚Ä¢ Miami</div>
                        <span class="seller-badge realtor">Verified Realtor</span>
                        <div class="seller-stats">Sold 89 homes ‚Ä¢ ‚≠ê 4.9 ‚Ä¢ Pro</div>
                    </div>
                    <div class="seller-hover">Beachfront property expert</div>
                </div>
                <div class="seller-card">
                    <img class="seller-avatar" src="https://ui-avatars.com/api/?name=Carlos+M&background=f59e0b&color=fff&size=80" alt="Carlos M." />
                    <div class="seller-info">
                        <div class="seller-name">Carlos M. ‚Ä¢ Nassau</div>
                        <span class="seller-badge">Verified Dealer</span>
                        <div class="seller-stats">Sold 67 boats ‚Ä¢ ‚≠ê 4.8 ‚Ä¢ Pro</div>
                    </div>
                    <div class="seller-hover">Caribbean yacht specialist</div>
                </div>
                <div class="seller-card">
                    <img class="seller-avatar" src="https://ui-avatars.com/api/?name=Lisa+W&background=10b981&color=fff&size=80" alt="Lisa W." />
                    <div class="seller-info">
                        <div class="seller-name">Lisa W. ‚Ä¢ Minneapolis</div>
                        <span class="seller-badge mechanic">Certified Mechanic</span>
                        <div class="seller-stats">Sold 203 parts ‚Ä¢ ‚≠ê 5.0 ‚Ä¢ Pro</div>
                    </div>
                    <div class="seller-hover">Engine & performance parts</div>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="categories-section">
            <h2 class="section-title">Browse Categories</h2>
            <p class="section-subtitle">Find exactly what you're looking for</p>
            <div class="categories-grid">
                <div class="category-card" data-color="blue" onclick="selectCategory('cars');">
                    <div class="category-icon">üöó</div>
                    <h3 class="category-name">Cars</h3>
                    <p class="category-count">6 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
                <div class="category-card" data-color="orange" onclick="selectCategory('trucks');">
                    <div class="category-icon">üöö</div>
                    <h3 class="category-name">Trucks</h3>
                    <p class="category-count">5 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
                <div class="category-card" data-color="red" onclick="selectCategory('motorcycles');">
                    <div class="category-icon">üèçÔ∏è</div>
                    <h3 class="category-name">Motorcycles</h3>
                    <p class="category-count">4 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
                <div class="category-card" data-color="cyan" onclick="selectCategory('boats');">
                    <div class="category-icon">‚õµ</div>
                    <h3 class="category-name">Boats</h3>
                    <p class="category-count">4 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
                <div class="category-card" data-color="purple" onclick="selectCategory('planes');">
                    <div class="category-icon">‚úàÔ∏è</div>
                    <h3 class="category-name">Planes</h3>
                    <p class="category-count">4 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
                <div class="category-card" data-color="teal" onclick="selectCategory('properties');">
                    <div class="category-icon">üè†</div>
                    <h3 class="category-name">Properties</h3>
                    <p class="category-count">6 listings</p>
                    <div class="category-hover-effect"></div>
                </div>
            </div>
        </section>

        <!-- Listings Section -->
        <section class="featured-section" id="featured">
            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-wrapper" style="display: flex; gap: 0.75rem; align-items: center;">
                    <div style="position: relative; flex: 1;">
                        <input 
                            type="text" 
                            class="search-input" 
                            id="search-input"
                            placeholder="Search listings... try 'BMW' or 'house under 500k'"
                            oninput="handleSearch(this.value)"
                        />
                        <span class="search-icon">üîç</span>
                        <button class="search-clear" id="search-clear" onclick="clearSearch()">√ó</button>
                    </div>
                    
                    <!-- Location Picker -->
                    <div class="location-picker">
                        <button class="location-btn" id="location-btn" onclick="toggleLocationDropdown()">üìç</button>
                        <div class="location-dropdown" id="location-dropdown">
                            <div class="location-dropdown-inner" id="location-content">
                                <!-- Content populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compare Button -->
                    <button class="compare-btn" id="compare-toggle-btn" onclick="toggleCompareMode()">
                        <span>‚öñÔ∏è</span>
                        <span id="compare-btn-text">Compare</span>
                    </button>
                </div>
                <p class="search-hint">Try: <span>Tesla</span> <span>under 100k</span> <span>Miami</span> <span>luxury</span></p>
            </div>

            <h2 class="section-title" id="listings-title">Cars For Sale</h2>
            <p class="section-subtitle" id="listings-subtitle">6 vehicles available</p>
            <div class="listings-grid" id="listings-grid">
                <!-- Cards populated by JavaScript -->
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="cta-background"></div>
            <div class="cta-content">
                <h2 class="cta-title">Ready to List Your Item?</h2>
                <p class="cta-subtitle">Join our marketplace and reach thousands of potential buyers</p>
                <button class="cta-button" onclick="openModal('signup')">Create Your Listing</button>
            </div>
        </section>
    </main>

    <!-- Sign Up Modal -->
    <div class="modal-overlay" id="signupModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('signup')">&times;</button>
            <h2 class="modal-title">Join as a Creator</h2>
            <p class="modal-subtitle">Sign up to start listing and selling</p>
            <form id="signupForm" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-input" id="signup-name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="signup-email" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="signup-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="8">
                </div>
                <div class="form-group">
                    <label class="form-label">What do you sell? <span style="color: #ef4444;">*</span></label>
                    <select class="form-select" id="signup-role" required>
                        <option value="" disabled selected>Select your seller type...</option>
                        <option value="realtor">üè† Realtor</option>
                        <option value="car-dealer">üöó Car Dealer</option>
                        <option value="mechanic">üîß Mechanic</option>
                        <option value="appliance-seller">üì∫ Appliance Seller</option>
                        <option value="other">üì¶ Other</option>
                    </select>
                </div>
                <div class="terms-checkbox-container">
                    <input type="checkbox" class="terms-checkbox" id="signup-terms" />
                    <label class="terms-label">
                        I agree to the <span class="terms-link" onclick="openLegalModal('terms')">Terms of Service</span>, <span class="terms-link" onclick="openLegalModal('privacy')">Privacy Policy</span> & <span class="terms-link" onclick="openLegalModal('terms')">Caribbean User Agreement</span>
                    </label>
                </div>
                <div class="terms-error" id="terms-error">Please accept the Terms of Service to continue.</div>
                <button type="submit" class="create-ad-btn">Create Account</button>
                <div class="form-footer">
                    Already have an account? <a href="#" onclick="switchModal('login')">Sign in</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('login')">&times;</button>
            <h2 class="modal-title">Welcome Back</h2>
            <p class="modal-subtitle">Sign in to your account</p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" placeholder="john@example.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="create-ad-btn">Login</button>
                <div class="form-footer">
                    Don't have an account? <a href="#" onclick="switchModal('signup')">Sign up</a>
                </div>
            </form>
        </div>
    </div>

    <!-- 360¬∞ Tour Viewer -->
    <div class="tour-viewer" id="tour-viewer">
        <div class="tour-header">
            <button class="tour-back-btn" onclick="closeTour()">
                ‚Üê Back
            </button>
            <span class="tour-title" id="tour-title">360¬∞ Tour</span>
            <span class="tour-instructions">üëÜ Drag to look around</span>
        </div>
        <div class="tour-container" id="tour-container">
            <img class="tour-panorama" id="tour-panorama" src="" alt="360 panorama" draggable="false" />
            <!-- Hotspots will be added dynamically -->
        </div>
        <div class="tour-footer">
            <button class="tour-nav-dot active" onclick="goToHotspot(0)"></button>
            <button class="tour-nav-dot" onclick="goToHotspot(1)"></button>
            <button class="tour-nav-dot" onclick="goToHotspot(2)"></button>
            <button class="tour-nav-dot" onclick="goToHotspot(3)"></button>
        </div>
    </div>

    <!-- Hotspot Zoom Modal -->
    <div class="hotspot-zoom" id="hotspot-zoom">
        <button class="hotspot-zoom-close" onclick="closeHotspotZoom()">√ó</button>
        <img class="hotspot-zoom-image" id="hotspot-zoom-image" src="" alt="Zoom view" />
        <h3 class="hotspot-zoom-title" id="hotspot-zoom-title">Detail View</h3>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-topbar">
            <h1 class="admin-title">Admin Panel ‚Äî <span class="brand-dynamic">Treazure Yaad</span></h1>
            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('overview')">üìä Overview</button>
                <button class="admin-tab" onclick="switchAdminTab('heatmap')">üó∫Ô∏è Heat Map</button>
            </div>
            <div class="admin-health-card" id="admin-health-card">
                <div class="health-pulse"></div>
                <div class="health-header">
                    <span class="health-dot"></span>
                    <span>System Health</span>
                </div>
                <div class="health-stats">
                    <div class="health-stat">
                        <span class="health-label">Uptime</span>
                        <span class="health-value" id="health-uptime">99.7%</span>
                    </div>
                    <div class="health-stat">
                        <span class="health-label">Server Speed</span>
                        <span class="health-value" id="health-speed">200ms</span>
                    </div>
                    <div class="health-stat">
                        <span class="health-label">Errors</span>
                        <span class="health-value" id="health-errors">0</span>
                    </div>
                </div>
            </div>
            <button class="admin-logout-btn" onclick="adminLogout()">üö™ Logout</button>
        </div>
        
        <!-- Overview Tab -->
        <div class="admin-tab-content active" id="admin-tab-overview">
        <div class="admin-layout">
            <div class="admin-main-columns">
                <!-- Left: Users -->
                <div class="admin-column">
                    <h2 class="admin-column-title">üë• Users</h2>
                    <div class="admin-column-content" id="admin-users-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Middle: Premium -->
                <div class="admin-column">
                    <h2 class="admin-column-title">‚≠ê Premium</h2>
                    <div class="admin-column-content" id="admin-premium-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
                
                <!-- Right: Payments -->
                <div class="admin-column">
                    <h2 class="admin-column-title">üí≥ Payments</h2>
                    <div class="admin-column-content" id="admin-payments-list">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            
            <!-- Fixed Sidebar: Live Activity Feed -->
            <div class="admin-activity-feed">
                <h2 class="admin-column-title">üì° Live Activity Feed</h2>
                <div class="admin-activity-list" id="admin-activity-list">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
        
        <!-- Action Log -->
        <div class="admin-log" id="admin-log">
            Last action: None yet
        </div>
        </div>
        </div>
        
        <!-- Heat Map Tab -->
        <div class="admin-tab-content" id="admin-tab-heatmap">
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <h2 class="heatmap-title">üåç User Locations <span id="heatmap-total">(1,247 total)</span></h2>
                    <div class="heatmap-legend">
                        <span class="legend-item"><span class="legend-dot gold"></span> Pro User</span>
                        <span class="legend-item"><span class="legend-dot purple"></span> Regular</span>
                    </div>
                </div>
                
                <div class="heatmap-map-container" id="world-map-container">
                    <svg class="heatmap-svg" id="world-map" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet">
                        <!-- World Map Continents (simplified outlines) -->
                        <!-- North America -->
                        <path class="continent" d="M120,80 L180,60 L240,70 L280,90 L300,120 L280,160 L260,200 L240,230 L200,250 L160,260 L140,280 L160,300 L200,320 L240,340 L260,380 L240,400 L200,390 L160,370 L120,340 L100,300 L80,260 L60,220 L80,180 L100,140 L120,100 Z"/>
                        <!-- South America -->
                        <path class="continent" d="M220,380 L260,360 L300,380 L320,420 L310,460 L280,480 L240,470 L210,440 L200,400 Z"/>
                        <!-- Europe -->
                        <path class="continent" d="M440,80 L500,70 L560,80 L580,100 L570,130 L540,150 L500,160 L460,150 L440,130 L430,100 Z"/>
                        <!-- Africa -->
                        <path class="continent" d="M440,180 L500,170 L560,190 L580,240 L570,300 L540,360 L500,400 L460,380 L440,320 L430,260 L440,200 Z"/>
                        <!-- Asia -->
                        <path class="continent" d="M580,60 L700,50 L800,70 L880,100 L920,150 L900,200 L860,240 L800,260 L740,250 L680,230 L620,200 L580,160 L560,120 L570,80 Z"/>
                        <!-- Australia -->
                        <path class="continent" d="M780,340 L840,330 L880,350 L890,390 L870,420 L830,430 L790,420 L770,390 L780,360 Z"/>
                        
                        <!-- Dynamic dots will be added here by JavaScript -->
                        <g id="heatmap-dots"></g>
                    </svg>
                </div>
                
                <!-- User List Popup -->
                <div class="heatmap-user-popup" id="heatmap-user-popup">
                    <div class="popup-header">
                        <span class="popup-location" id="popup-location">Minneapolis, MN</span>
                        <button class="popup-close" onclick="closeUserPopup()">√ó</button>
                    </div>
                    <div class="popup-users" id="popup-users">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Edit Modal -->
    <div class="admin-modal" id="admin-modal">
        <div class="admin-modal-content">
            <h2 class="admin-modal-title" id="admin-modal-title">Edit User</h2>
            <div id="admin-modal-body">
                <!-- Form content -->
            </div>
            <div class="admin-modal-actions">
                <button class="admin-modal-btn cancel" onclick="closeAdminModal()">Cancel</button>
                <button class="admin-modal-btn save" id="admin-modal-save">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Floating Chat Support Button -->
    <div class="chat-float-btn" id="chat-float-btn" onclick="toggleChatPanel()" title="Help anytime">
        <span class="chat-float-icon">üí¨</span>
    </div>

    <!-- Chat Support Panel -->
    <div class="chat-panel" id="chat-panel">
        <div class="chat-panel-header">
            <h3>üí¨ Need Help?</h3>
            <button class="chat-panel-close" onclick="toggleChatPanel()">√ó</button>
        </div>
        <div class="chat-panel-body">
            <p class="chat-panel-intro">We're here to help! Send us a message and we'll get back to you ASAP.</p>
            <div class="chat-panel-field">
                <label>Your Name</label>
                <input type="text" id="chat-name" placeholder="Enter your name" />
            </div>
            <div class="chat-panel-field">
                <label>Your Message</label>
                <textarea id="chat-message" placeholder="How can we help you today?" rows="4"></textarea>
            </div>
            <button class="chat-panel-send" onclick="sendChatMessage()">Send Message</button>
        </div>
        <div class="chat-panel-footer">
            <span>üîí Your message is secure</span>
        </div>
    </div>

    <!-- Secret Admin Login Modal -->
    <div class="admin-login-modal" id="admin-login-modal">
        <div class="admin-login-box">
            <h2 class="admin-login-title">üîê Admin Access</h2>
            <p class="admin-login-subtitle">Authorized personnel only</p>
            <form id="admin-login-form" onsubmit="return handleAdminLogin(event)">
                <div class="admin-login-field">
                    <label>Username</label>
                    <input type="text" id="admin-username" placeholder="Enter username" autocomplete="off" required />
                </div>
                <div class="admin-login-field">
                    <label>Password</label>
                    <input type="password" id="admin-password" placeholder="Enter password" required />
                </div>
                <div class="admin-login-error" id="admin-login-error"></div>
                <button type="submit" class="admin-login-btn">Login</button>
                <button type="button" class="admin-login-cancel" onclick="closeAdminLogin()">Cancel</button>
            </form>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner">üöó</div>
        <div class="loading-text">Loading...</div>
    </div>

    <!-- 404 Page -->
    <div class="page-404" id="page-404">
        <div class="page-404-code">404</div>
        <div class="page-404-message">Oops! Page not found.</div>
        <button class="page-404-btn" onclick="goHome()">‚Üê Back to Home</button>
    </div>

    <!-- Mobile Hamburger Button -->
    <button class="hamburger-btn" id="hamburger-btn" onclick="toggleMobileMenu()">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
    </button>

    <!-- Mobile Drawer Overlay -->
    <div class="mobile-drawer-overlay" id="mobile-drawer-overlay" onclick="closeMobileMenu()"></div>

    <!-- Contact Form Modal -->
    <div class="contact-form-modal" id="contact-form-modal">
        <div class="contact-form-content">
            <h2 class="contact-form-title">üìß Contact Seller</h2>
            <p class="contact-form-subtitle" id="contact-listing-title">About: Listing Name</p>
            <input type="text" class="form-input" id="contact-name" placeholder="Your Name" style="margin-bottom: 1rem;" />
            <input type="email" class="form-input" id="contact-email" placeholder="Your Email" style="margin-bottom: 1rem;" />
            <textarea class="contact-textarea" id="contact-message" placeholder="Hi, I'm interested in this listing..."></textarea>
            <div class="contact-form-actions">
                <button class="contact-cancel-btn" onclick="closeContactForm()">Cancel</button>
                <button class="contact-send-btn" onclick="sendContactEmail()">üì§ Send via Email</button>
            </div>
        </div>
    </div>

    <!-- Legal Modal (Terms/Privacy popup) -->
    <div class="legal-modal" id="legal-modal">
        <div class="legal-modal-content">
            <div class="legal-modal-header">
                <h2 class="legal-modal-title" id="legal-modal-title">Terms of Service</h2>
                <button class="legal-modal-close" onclick="closeLegalModal()">√ó</button>
            </div>
            <div class="legal-modal-body">
                <div class="legal-text" id="legal-modal-body">
                    <!-- Content populated by JavaScript -->
                </div>
            </div>
            <div class="legal-modal-footer">
                <button class="legal-accept-btn" onclick="acceptLegalTerms()">Accept & Continue</button>
            </div>
        </div>
    </div>

    <!-- Terms of Use Page -->
    <div class="legal-page" id="terms-page">
        <div class="legal-page-container">
            <button class="legal-back-btn" onclick="closeLegalPage()">‚Üê Back to Treazure Yaad</button>
            <div class="legal-page-header">
                <h1 class="legal-page-title">Terms of Use & Caribbean User Agreement</h1>
                <p class="legal-page-updated">Last updated: January 17, 2026</p>
            </div>
            <div class="legal-page-content">
                <h2>1. Service Area</h2>
                <p>Treazure Yaad serves users in the United States, Canada, and the Caribbean. By accessing and using Treazure Yaad ("the Service"), you accept and agree to be bound by the terms and provisions of this agreement. If you do not agree to abide by the above, please do not use this service.</p>
                
                <h2>2. Eligibility & Certification</h2>
                <p>You certify that your listings are real, legal in your local jurisdiction, and that you are at least eighteen (18) years old ‚Äî even if that means sixteen in some islands. By using the Service, you represent and warrant that you meet the legal age requirement in your jurisdiction and have the legal capacity to enter into these Terms.</p>
                
                <h2>3. Listing Requirements</h2>
                <p>All listings posted on Treazure Yaad must represent real, legitimate items or properties available for sale or rent. Users certify that:</p>
                <ul>
                    <li>All listings are real and accurately described</li>
                    <li>All items and services are legal in the user's local jurisdiction</li>
                    <li>Photographs are genuine and unaltered</li>
                    <li>Pricing is accurate and not misleading</li>
                    <li>No prohibited items are listed (weapons, illegal substances, counterfeit goods)</li>
                </ul>
                
                <h2>4. Data Storage</h2>
                <p>All user data is stored on secure servers located in the United States of America. By using our service, you consent to the transfer, processing, and storage of your data on US servers, regardless of your country of residence. This includes users in Canada and the Caribbean.</p>
                
                <h2>5. Dispute Resolution & Arbitration</h2>
                <p>Local laws apply to all transactions conducted through the platform. However, any disputes arising from the use of this platform shall be resolved through binding arbitration only, conducted in the State of Florida, USA. By using this Service, you expressly waive:</p>
                <ul>
                    <li>Your right to file or participate in class action lawsuits</li>
                    <li>Your right to a jury trial</li>
                    <li>Your right to resolve disputes in court</li>
                </ul>
                <p>All disputes must be submitted to arbitration within one (1) year of the incident giving rise to the claim. Arbitration costs shall be shared equally unless otherwise determined by the arbitrator.</p>
                
                <h2>6. Account Termination</h2>
                <p>You can be banned for fake listings, fraudulent activity, or any violation of these terms. Account bans are final with no appeal process. We reserve the right to terminate or suspend your account immediately, without prior notice, liability, or explanation, for any reason whatsoever. Upon termination, your right to use the Service will cease immediately.</p>
                
                <h2>7. Refund Policy</h2>
                <p><strong>Caribbean Transactions:</strong> We do not issue refunds on Caribbean transactions unless fraud is proven within seven (7) days of the transaction date. Proof of fraud must be submitted with supporting documentation including transaction records, communication logs, and any relevant evidence. All other refund requests for Caribbean transactions will be denied.</p>
                <p><strong>US & Canadian Transactions:</strong> Pro subscriptions may be refunded within seven (7) days of initial purchase. After this period, no refunds will be issued. Cancellation takes effect at the end of the current billing period.</p>
                
                <h2>8. Prohibited Conduct</h2>
                <p>Users shall not engage in any of the following:</p>
                <ul>
                    <li>Posting fake, fraudulent, or misleading listings</li>
                    <li>Scamming, fraud, or misrepresentation of any kind</li>
                    <li>Harassment of other users</li>
                    <li>Spamming or posting duplicate listings</li>
                    <li>Attempting to circumvent platform fees</li>
                    <li>Violating any applicable local, state, or federal laws</li>
                </ul>
                
                <h2>9. Limitation of Liability</h2>
                <p>In no event shall Treazure Yaad, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses. Treazure Yaad is not responsible for transactions between users. We provide the platform; all dealings are between buyers and sellers.</p>
                
                <h2>10. Governing Law</h2>
                <p>These Terms shall be governed and construed in accordance with the laws of the State of Florida, United States of America, without regard to its conflict of law provisions. Local laws apply to individual transactions, but platform-related disputes fall under Florida jurisdiction.</p>
                
                <h2>11. Changes to Terms</h2>
                <p>We reserve the right, at our sole discretion, to modify or replace these Terms at any time. We will provide notice of any changes by posting the new Terms on this page. Continued use of the Service after changes constitutes acceptance of the revised terms.</p>
                
                <h2>12. Contact Us</h2>
                <p>If you have any questions about these Terms, please contact us at legal@marketplace.com.</p>
            </div>
        </div>
    </div>

    <!-- Privacy Policy Page -->
    <div class="legal-page" id="privacy-page">
        <div class="legal-page-container">
            <button class="legal-back-btn" onclick="closeLegalPage()">‚Üê Back to Treazure Yaad</button>
            <div class="legal-page-header">
                <h1 class="legal-page-title">Privacy Policy</h1>
                <p class="legal-page-updated">Last updated: January 17, 2026</p>
            </div>
            <div class="legal-page-content">
                <h2>1. Information We Collect</h2>
                <p>We collect information you provide directly to us, such as when you create an account, post a listing, make a purchase, or contact us for support. This information may include:</p>
                <ul>
                    <li>Name, email address, and password</li>
                    <li>Phone number and billing address</li>
                    <li>Payment information (processed securely via third-party providers)</li>
                    <li>Listing content, including photos and descriptions</li>
                    <li>Communications with other users</li>
                </ul>
                
                <h2>2. Cookies and Tracking Technologies</h2>
                <p>We use cookies and similar tracking technologies to track activity on our Service and hold certain information. Cookies are files with small amounts of data which may include an anonymous unique identifier.</p>
                <ul>
                    <li>Essential cookies for site functionality</li>
                    <li>Analytics cookies to understand usage patterns</li>
                    <li>Advertising cookies to serve relevant ads</li>
                    <li>Preference cookies to remember your settings</li>
                </ul>
                
                <h2>3. How We Use Your Information</h2>
                <p>We use the information we collect to:</p>
                <ul>
                    <li>Provide, maintain, and improve our services</li>
                    <li>Process transactions and send related information</li>
                    <li>Send promotional communications (with your consent)</li>
                    <li>Respond to your comments, questions, and requests</li>
                    <li>Monitor and analyze trends, usage, and activities</li>
                    <li>Detect, investigate, and prevent fraudulent transactions</li>
                </ul>
                
                <h2>4. Data Storage and Security</h2>
                <p>Your data is stored on secure servers located in the United States of America. We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.</p>
                
                <h2>5. Data Sharing</h2>
                <p>We do not sell your personal information. We may share your information with:</p>
                <ul>
                    <li>Service providers who assist in our operations</li>
                    <li>Law enforcement when required by law</li>
                    <li>Other users (only the information you choose to make public)</li>
                </ul>
                
                <h2>6. Your Rights</h2>
                <p>Depending on your location, you may have the right to:</p>
                <ul>
                    <li>Access the personal data we hold about you</li>
                    <li>Request correction of inaccurate data</li>
                    <li>Request deletion of your data</li>
                    <li>Object to processing of your data</li>
                    <li>Request data portability</li>
                </ul>
                
                <h2>7. Data Retention</h2>
                <p>We retain your personal information for as long as your account is active or as needed to provide you services. We will retain and use your information as necessary to comply with our legal obligations, resolve disputes, and enforce our agreements.</p>
                
                <h2>8. Children's Privacy</h2>
                <p>Our Service does not address anyone under the age of 18. We do not knowingly collect personally identifiable information from anyone under the age of 18.</p>
                
                <h2>9. Changes to This Policy</h2>
                <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date.</p>
                
                <h2>10. Contact Us</h2>
                <p>If you have any questions about this Privacy Policy, please contact us at privacy@marketplace.com.</p>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-number">10,000+</div>
                <div class="stat-label">Active Listings</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üòä</div>
                <div class="stat-number">50,000+</div>
                <div class="stat-label">Happy Customers</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-number">500+</div>
                <div class="stat-label">Daily Visitors</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚≠ê</div>
                <div class="stat-number">99%</div>
                <div class="stat-label">Satisfaction Rate</div>
            </div>
        </div>
    </section>

    <!-- Site Footer -->
    <footer class="site-footer" id="site-footer">
        <span class="footer-link" onclick="openLegalPage('terms')">Terms of Use</span>
        <span class="footer-divider">|</span>
        <span class="footer-link" onclick="openLegalPage('privacy')">Privacy Policy</span>
        <span class="footer-divider">|</span>
        <span class="footer-link" onclick="openLegalPage('terms')">Caribbean User Agreement</span>
        <span class="footer-divider">|</span>
        <span class="footer-copyright">¬© 2026 Treazure Yaad. All rights reserved.</span>
    </footer>

    <!-- Floating Compare Bar -->
    <div class="compare-bar" id="compare-bar">
        <span class="compare-bar-count" id="compare-bar-count">0/4 selected</span>
        <div class="compare-bar-items" id="compare-bar-items"></div>
        <button class="compare-bar-btn" onclick="openCompareView()">Compare Now ‚Üí</button>
        <button class="compare-bar-clear" onclick="clearCompare()">Clear All</button>
    </div>

    <!-- Area Legends Modal -->
    <div class="modal-overlay" id="legendsModal">
        <div class="modal-content legends-modal-content">
            <button class="modal-close" onclick="closeModal('legends')">&times;</button>
            <div class="legends-header">
                <span class="legends-icon" id="legends-icon">üèîÔ∏è</span>
                <div class="legends-title-group">
                    <div class="legends-location" id="legends-location">Montana</div>
                    <div class="legends-title" id="legends-title">Big Sky Country Secrets</div>
                </div>
            </div>
            <div class="legends-body">
                <p class="legends-text" id="legends-text">Loading...</p>
            </div>
            <div class="legends-footer">
                <span class="legends-disclaimer">üìö A mix of folklore, history, and local whispers</span>
                <button class="legends-share-btn" onclick="shareLegend()">üì§ Share</button>
            </div>
        </div>
    </div>

    <!-- Edit Listing Modal -->
    <div class="modal-overlay" id="editListingModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('editListing')">&times;</button>
            <h2 class="modal-title">Edit Listing</h2>
            <p class="modal-subtitle">Update your listing details</p>
            <form onsubmit="event.preventDefault(); saveListingEdit();">
                <input type="hidden" id="edit-listing-id" />
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="edit-listing-title" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Price</label>
                    <input type="text" class="form-input" id="edit-listing-price" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="edit-listing-location" required>
                </div>
                <button type="submit" class="create-ad-btn">üíæ Save Changes</button>
            </form>
        </div>
    </div>

    <!-- Bid Modal -->
    <div class="modal-overlay" id="bidModal">
        <div class="modal-content" style="max-width: 450px;">
            <button class="modal-close" onclick="closeModal('bid')">&times;</button>
            <h2 class="modal-title" id="bid-modal-title">Place Your Bid</h2>
            <p class="modal-subtitle">Enter your maximum bid amount</p>
            
            <div class="bid-input-container">
                <span class="bid-input-prefix">$</span>
                <input type="number" class="bid-input" id="bid-amount-input" min="0" step="100" />
            </div>
            
            <p class="min-bid-hint">Minimum bid: <span id="bid-min-amount">$0</span></p>
            
            <button class="place-bid-btn" onclick="submitBid()">üî• Confirm Bid</button>
        </div>
    </div>

    <!-- Premium Pricing Modal -->
    <div class="modal-overlay" id="pricingModal">
        <div class="modal-content" style="max-width: 700px;">
            <button class="modal-close" onclick="closeModal('pricing')">&times;</button>
            <h2 class="modal-title">Upgrade to Pro</h2>
            <p class="modal-subtitle">Unlock unlimited chat and premium features</p>
            
            <div class="pricing-grid">
                <!-- Basic Tier -->
                <div class="pricing-card">
                    <div class="pricing-tier">Basic</div>
                    <div class="pricing-price">Free</div>
                    <div class="pricing-period">Forever</div>
                    <ul class="pricing-features">
                        <li class="included"><span class="check">‚úì</span> Browse all listings</li>
                        <li class="included"><span class="check">‚úì</span> Post up to 3 listings</li>
                        <li><span class="cross">‚úó</span> Chat with sellers</li>
                        <li><span class="cross">‚úó</span> Featured listings</li>
                        <li><span class="cross">‚úó</span> Priority support</li>
                    </ul>
                    <button class="pricing-btn basic" onclick="selectBasic()">Current Plan</button>
                </div>
                
                <!-- Pro Monthly -->
                <div class="pricing-card popular">
                    <div class="popular-badge">Most Popular</div>
                    <div class="pricing-tier">Pro Monthly</div>
                    <div class="pricing-price">$9.99</div>
                    <div class="pricing-period">per month</div>
                    <ul class="pricing-features">
                        <li class="included"><span class="check">‚úì</span> Browse all listings</li>
                        <li class="included"><span class="check">‚úì</span> Unlimited listings</li>
                        <li class="included"><span class="check">‚úì</span> Unlimited chat</li>
                        <li class="included"><span class="check">‚úì</span> Featured listings</li>
                        <li class="included"><span class="check">‚úì</span> Priority support</li>
                    </ul>
                    <div class="payment-buttons">
                        <button class="pricing-btn stripe-btn" onclick="handleStripeCheckout('monthly')">
                            <span class="btn-icon">üí≥</span> Stripe
                        </button>
                        <button class="pricing-btn paypal-btn" onclick="handlePayPalCheckout('monthly')">
                            <span class="btn-icon">üÖøÔ∏è</span> PayPal
                        </button>
                    </div>
                    <div class="payment-buttons wallet-buttons">
                        <button class="pricing-btn apple-btn" onclick="handleApplePayCheckout('monthly')">
                             Apple Pay
                        </button>
                        <button class="pricing-btn google-btn" onclick="handleGooglePayCheckout('monthly')">
                            <span class="gpay-icon">G</span> Pay
                        </button>
                    </div>
                </div>
                
                <!-- Pro Annual -->
                <div class="pricing-card">
                    <div class="save-badge">Save 17%</div>
                    <div class="pricing-tier">Pro Annual</div>
                    <div class="pricing-price">$99.99</div>
                    <div class="pricing-period">per year</div>
                    <ul class="pricing-features">
                        <li class="included"><span class="check">‚úì</span> Everything in Monthly</li>
                        <li class="included"><span class="check">‚úì</span> 2 months free</li>
                        <li class="included"><span class="check">‚úì</span> Early feature access</li>
                        <li class="included"><span class="check">‚úì</span> Exclusive badge</li>
                        <li class="included"><span class="check">‚úì</span> VIP support</li>
                    </ul>
                    <div class="payment-buttons">
                        <button class="pricing-btn stripe-btn annual" onclick="handleStripeCheckout('annual')">
                            <span class="btn-icon">üí≥</span> Stripe
                        </button>
                        <button class="pricing-btn paypal-btn annual" onclick="handlePayPalCheckout('annual')">
                            <span class="btn-icon">üÖøÔ∏è</span> PayPal
                        </button>
                    </div>
                    <div class="payment-buttons wallet-buttons">
                        <button class="pricing-btn apple-btn" onclick="handleApplePayCheckout('annual')">
                             Apple Pay
                        </button>
                        <button class="pricing-btn google-btn" onclick="handleGooglePayCheckout('annual')">
                            <span class="gpay-icon">G</span> Pay
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="payment-security">
                <div class="payment-badges">
                    <span class="payment-badge stripe">üí≥ Stripe</span>
                    <span class="payment-badge paypal">üÖøÔ∏è PayPal</span>
                    <span class="payment-badge apple"> Pay</span>
                    <span class="payment-badge google"><span class="gpay-icon-sm">G</span> Pay</span>
                </div>
                <span class="security-text">üîí Secure payment ‚Ä¢ Cancel anytime ‚Ä¢ SSL encrypted</span>
            </div>
        </div>
    </div>

    <!-- Post Listing Modal -->
    <div class="modal-overlay" id="postListingModal">
        <div class="modal-content" style="max-width: 550px;">
            <button class="modal-close" onclick="closeModal('postListing')">&times;</button>
            <h2 class="modal-title">Post a Listing</h2>
            <p class="modal-subtitle">Create your ad and reach thousands of buyers</p>
            <form id="postListingForm" onsubmit="handlePostListing(event)">
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="listing-title" placeholder="e.g., 2024 Tesla Model 3" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Price</label>
                    <input type="text" class="form-input" id="listing-price" placeholder="e.g., $45,000 or $250/day" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" id="listing-location" placeholder="e.g., Miami, FL" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <select class="form-select" id="listing-category" required>
                        <option value="" disabled selected>Select category...</option>
                        <option value="cars">üöó Cars</option>
                        <option value="trucks">üöö Trucks</option>
                        <option value="motorcycles">üèçÔ∏è Motorcycles</option>
                        <option value="boats">‚õµ Boats</option>
                        <option value="properties">üè† Properties</option>
                        <option value="land">üåç Land</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Listing Type <span style="color: #ef4444;">*</span></label>
                    <div class="radio-group">
                        <label class="radio-label selected" id="radio-buy" onclick="selectListingType('buy')">
                            <input type="radio" name="listingType" value="buy" checked>
                            <span class="radio-indicator"></span>
                            <span>üõí Buy</span>
                        </label>
                        <label class="radio-label" id="radio-rent" onclick="selectListingType('rent')">
                            <input type="radio" name="listingType" value="rent">
                            <span class="radio-indicator"></span>
                            <span>üîë Rent</span>
                        </label>
                    </div>
                    <!-- Rental Sub-type Dropdown -->
                    <div class="sub-dropdown" id="rental-subtype-container" style="display: none;">
                        <label class="sub-dropdown-label">What type of rental?</label>
                        <select class="form-select" id="rental-subtype">
                            <option value="" disabled selected>Select rental type...</option>
                            <option value="rent-cars">üöó Rent Cars</option>
                            <option value="lease-land">üåç Lease Land</option>
                            <option value="lease-property">üè† Lease Property</option>
                            <option value="lease-boats">‚õµ Lease Boats</option>
                            <option value="short-term">üèñÔ∏è Short-Term Rentals</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="create-ad-btn">Post Listing</button>
            </form>
        </div>
    </div>

    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD" data-sdk-integration-source="button-factory"></script>
    
    <script>
        // ===== STRIPE CONFIGURATION =====
        // Replace with your Stripe Publishable Key (starts with pk_)
        const STRIPE_PUBLISHABLE_KEY = 'pk_test_YOUR_PUBLISHABLE_KEY_HERE';
        
        // Replace with your Stripe Price ID for Pro subscription
        // Create this in Stripe Dashboard > Products > Add Product > Add Price
        const STRIPE_PRO_PRICE_ID = 'price_YOUR_PRICE_ID_HERE';
        
        // ===== PAYPAL CONFIGURATION =====
        // Replace with your PayPal Client ID from developer.paypal.com
        const PAYPAL_CLIENT_ID = 'YOUR_PAYPAL_CLIENT_ID';
        
        // PayPal Plan IDs (create in PayPal Dashboard > Products & Subscriptions)
        const PAYPAL_PLANS = {
            monthly: 'P-XXXXX',  // Monthly subscription plan ID
            annual: 'P-YYYYY'   // Annual subscription plan ID
        };
        
        // Your success/cancel URLs (update with your domain)
        const SUCCESS_URL = window.location.origin + window.location.pathname + '#premium-success';
        const CANCEL_URL = window.location.origin + window.location.pathname + '#premium-pricing';
        
        // Initialize Stripe
        let stripe = null;
        try {
            if (STRIPE_PUBLISHABLE_KEY && !STRIPE_PUBLISHABLE_KEY.includes('YOUR_')) {
                stripe = Stripe(STRIPE_PUBLISHABLE_KEY);
            }
        } catch (e) {
            console.log('Stripe not configured yet');
        }
        
        // Stripe Price IDs (create these in your Stripe Dashboard)
        const STRIPE_PRICES = {
            monthly: 'price_MONTHLY_PRICE_ID_HERE',  // $9.99/month
            annual: 'price_ANNUAL_PRICE_ID_HERE'     // $99.99/year
        };
        
        // Handle Stripe Checkout
        async function handleStripeCheckout(plan) {
            // Check if Stripe is configured
            if (!stripe) {
                // Fallback to demo mode if Stripe not configured
                showStripeDemo(plan);
                return;
            }
            
            try {
                // Show loading
                showLoadingSpinner();
                
                // For client-only checkout, use Stripe Payment Links
                // In production, you'd create a Checkout Session on your server
                
                const priceId = STRIPE_PRICES[plan];
                
                // Redirect to Stripe Checkout
                const { error } = await stripe.redirectToCheckout({
                    lineItems: [{ price: priceId, quantity: 1 }],
                    mode: 'subscription',
                    successUrl: SUCCESS_URL,
                    cancelUrl: CANCEL_URL,
                });
                
                if (error) {
                    console.error('Stripe error:', error);
                    hideLoadingSpinner();
                    alert('Payment error: ' + error.message);
                }
            } catch (err) {
                console.error('Checkout error:', err);
                hideLoadingSpinner();
                showStripeDemo(plan);
            }
        }
        
        // Demo mode when Stripe isn't configured
        function showStripeDemo(plan) {
            const planDetails = {
                monthly: { name: 'Pro Monthly', price: '$9.99/month' },
                annual: { name: 'Pro Annual', price: '$99.99/year' }
            };
            
            const details = planDetails[plan];
            
            // Close pricing modal
            closeModal('pricing');
            
            // Show demo payment modal
            const demoHTML = `
                <div class="modal-overlay active" id="stripeDemo" onclick="if(event.target === this) closeStripeDemo()">
                    <div class="modal-content" style="max-width: 450px;">
                        <button class="modal-close" onclick="closeStripeDemo()">&times;</button>
                        <div class="stripe-demo-header">
                            <div class="stripe-demo-logo">üí≥</div>
                            <h2>Stripe Checkout</h2>
                            <p class="stripe-demo-plan">${details.name} - ${details.price}</p>
                        </div>
                        
                        <div class="stripe-demo-info">
                            <p>‚ö†Ô∏è <strong>Demo Mode</strong></p>
                            <p>Stripe is not configured yet. To enable real payments:</p>
                            <ol>
                                <li>Create a <a href="https://dashboard.stripe.com/register" target="_blank">Stripe account</a></li>
                                <li>Get your Publishable Key from Dashboard</li>
                                <li>Create a Product with pricing ($9.99/mo, $99.99/yr)</li>
                                <li>Update the config in index.html</li>
                            </ol>
                        </div>
                        
                        <div class="stripe-demo-actions">
                            <button class="stripe-demo-btn simulate" onclick="simulatePayment('${plan}')">
                                ‚ú® Simulate Successful Payment
                            </button>
                            <button class="stripe-demo-btn cancel" onclick="closeStripeDemo()">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', demoHTML);
        }
        
        function closeStripeDemo() {
            const demo = document.getElementById('stripeDemo');
            if (demo) demo.remove();
        }
        
        function simulatePayment(plan) {
            closeStripeDemo();
            
            // Set Pro status
            localStorage.setItem('isPro', 'true');
            localStorage.setItem('proSince', new Date().toISOString());
            localStorage.setItem('proPlan', plan);
            
            // Show success
            showPaymentSuccess(plan);
        }
        
        function showPaymentSuccess(plan) {
            const planName = plan === 'annual' ? 'Pro Annual' : 'Pro Monthly';
            
            const successHTML = `
                <div class="modal-overlay active" id="paymentSuccess">
                    <div class="modal-content" style="max-width: 400px; text-align: center;">
                        <div class="success-icon">üéâ</div>
                        <h2 style="color: #10b981; margin: 1rem 0;">Payment Successful!</h2>
                        <p style="color: #9ca3af; margin-bottom: 1.5rem;">
                            Welcome to <strong>${planName}</strong>!<br>
                            You now have access to all Pro features.
                        </p>
                        <div class="success-features">
                            <div class="success-feature">‚úì Unlimited Chat</div>
                            <div class="success-feature">‚úì Featured Listings</div>
                            <div class="success-feature">‚úì Priority Support</div>
                        </div>
                        <button class="pricing-btn pro" style="margin-top: 1.5rem; width: 100%;" onclick="closePaymentSuccess()">
                            Start Exploring ‚Üí
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', successHTML);
            
            // Update UI
            updateProBadge();
        }
        
        function closePaymentSuccess() {
            const success = document.getElementById('paymentSuccess');
            if (success) success.remove();
            location.reload();
        }
        
        // Check for Stripe success redirect
        function checkStripeSuccess() {
            if (window.location.hash === '#premium-success') {
                localStorage.setItem('isPro', 'true');
                localStorage.setItem('proSince', new Date().toISOString());
                showPaymentSuccess('monthly');
                window.location.hash = '';
            }
        }
        
        // ===== PAYPAL CHECKOUT =====
        function handlePayPalCheckout(plan) {
            // Check if PayPal is configured
            if (!PAYPAL_CLIENT_ID || PAYPAL_CLIENT_ID.includes('YOUR_')) {
                showPayPalDemo(plan);
                return;
            }
            
            // For real PayPal, we'd use their SDK
            // This would typically be handled differently with their buttons
            showPayPalDemo(plan);
        }
        
        function showPayPalDemo(plan) {
            const planDetails = {
                monthly: { name: 'Pro Monthly', price: '$9.99/month' },
                annual: { name: 'Pro Annual', price: '$99.99/year' }
            };
            
            const details = planDetails[plan];
            
            closeModal('pricing');
            
            const demoHTML = `
                <div class="modal-overlay active" id="paypalDemo" onclick="if(event.target === this) closePayPalDemo()">
                    <div class="modal-content" style="max-width: 450px;">
                        <button class="modal-close" onclick="closePayPalDemo()">&times;</button>
                        <div class="paypal-demo-header">
                            <div class="paypal-demo-logo">üÖøÔ∏è</div>
                            <h2 style="color: #0070ba;">PayPal Checkout</h2>
                            <p class="paypal-demo-plan">${details.name} - ${details.price}</p>
                        </div>
                        
                        <div class="paypal-demo-info">
                            <p>‚ö†Ô∏è <strong>Demo Mode</strong></p>
                            <p>PayPal is not configured yet. To enable real payments:</p>
                            <ol>
                                <li>Create a <a href="https://developer.paypal.com" target="_blank">PayPal Developer account</a></li>
                                <li>Create an App to get your Client ID</li>
                                <li>Create subscription plans in PayPal Dashboard</li>
                                <li>Update the config in index.html</li>
                            </ol>
                        </div>
                        
                        <div class="paypal-demo-actions">
                            <button class="paypal-demo-btn simulate" onclick="simulatePayPalPayment('${plan}')">
                                ‚ú® Simulate Successful Payment
                            </button>
                            <button class="paypal-demo-btn cancel" onclick="closePayPalDemo()">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', demoHTML);
        }
        
        function closePayPalDemo() {
            const demo = document.getElementById('paypalDemo');
            if (demo) demo.remove();
        }
        
        function simulatePayPalPayment(plan) {
            closePayPalDemo();
            
            localStorage.setItem('isPro', 'true');
            localStorage.setItem('proSince', new Date().toISOString());
            localStorage.setItem('proPlan', plan);
            localStorage.setItem('paymentMethod', 'PayPal');
            
            showPaymentSuccess(plan);
        }
        
        // ===== APPLE PAY =====
        function handleApplePayCheckout(plan) {
            // Apple Pay requires Stripe Payment Request API or Apple Pay JS
            // For demo, we'll show a simulation
            showWalletDemo('apple', plan);
        }
        
        // ===== GOOGLE PAY =====
        function handleGooglePayCheckout(plan) {
            // Google Pay uses Google Pay API or Stripe Payment Request
            // For demo, we'll show a simulation
            showWalletDemo('google', plan);
        }
        
        function showWalletDemo(wallet, plan) {
            const walletInfo = {
                apple: { name: 'Apple Pay', icon: '', color: '#000', textColor: '#fff' },
                google: { name: 'Google Pay', icon: '<span class="gpay-icon">G</span>', color: '#fff', textColor: '#3c4043' }
            };
            
            const planDetails = {
                monthly: { name: 'Pro Monthly', price: '$9.99/month' },
                annual: { name: 'Pro Annual', price: '$99.99/year' }
            };
            
            const w = walletInfo[wallet];
            const p = planDetails[plan];
            
            closeModal('pricing');
            
            const demoHTML = `
                <div class="modal-overlay active" id="walletDemo" onclick="if(event.target === this) closeWalletDemo()">
                    <div class="modal-content" style="max-width: 400px;">
                        <button class="modal-close" onclick="closeWalletDemo()">&times;</button>
                        <div class="wallet-demo-header" style="background: ${w.color}; color: ${w.textColor}; padding: 2rem; margin: -2rem -2rem 1.5rem -2rem; border-radius: 12px 12px 0 0; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">${w.icon} ${w.name}</div>
                            <div style="opacity: 0.8;">${p.name} - ${p.price}</div>
                        </div>
                        
                        <div class="wallet-demo-info" style="background: rgba(${wallet === 'apple' ? '0,0,0' : '66,133,244'},0.1); border: 1px solid ${wallet === 'apple' ? '#333' : '#4285f4'}; border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem;">
                            <p style="color: #e5e7eb; font-size: 0.85rem; margin-bottom: 0.75rem;">‚ö†Ô∏è <strong>Demo Mode</strong></p>
                            <p style="color: #9ca3af; font-size: 0.8rem; margin-bottom: 0.5rem;">
                                ${wallet === 'apple' ? 'Apple Pay' : 'Google Pay'} requires:
                            </p>
                            <ul style="color: #9ca3af; font-size: 0.8rem; padding-left: 1.25rem; margin: 0;">
                                <li>Stripe account with Payment Request API</li>
                                <li>${wallet === 'apple' ? 'Apple Developer account & domain verification' : 'Google Pay Business Console setup'}</li>
                                <li>HTTPS domain (required for wallet payments)</li>
                            </ul>
                        </div>
                        
                        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <button onclick="simulateWalletPayment('${wallet}', '${plan}')" style="padding: 14px; border-radius: 8px; font-size: 0.95rem; font-weight: 600; cursor: pointer; background: ${wallet === 'apple' ? '#000' : 'linear-gradient(135deg, #4285f4, #34a853)'}; color: #fff; border: none;">
                                ‚ú® Simulate ${w.name} Payment
                            </button>
                            <button onclick="closeWalletDemo()" style="padding: 14px; border-radius: 8px; font-size: 0.95rem; cursor: pointer; background: transparent; border: 1px solid #374151; color: #9ca3af;">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', demoHTML);
        }
        
        function closeWalletDemo() {
            const demo = document.getElementById('walletDemo');
            if (demo) demo.remove();
        }
        
        function simulateWalletPayment(wallet, plan) {
            closeWalletDemo();
            
            const walletName = wallet === 'apple' ? 'Apple Pay' : 'Google Pay';
            
            localStorage.setItem('isPro', 'true');
            localStorage.setItem('proSince', new Date().toISOString());
            localStorage.setItem('proPlan', plan);
            localStorage.setItem('paymentMethod', walletName);
            
            showPaymentSuccess(plan);
        }
    
    </script>
    
    <script>
        // Category data with colors and types
        const categories = {
            // Vehicles
            cars: { name: 'Cars', icon: 'üöó', color: '#3b82f6', colorDark: '#1d4ed8', type: 'vehicle' },
            trucks: { name: 'Trucks', icon: 'üöö', color: '#f97316', colorDark: '#c2410c', type: 'vehicle' },
            bikes: { name: 'Bikes', icon: 'üö≤', color: '#22c55e', colorDark: '#15803d', type: 'vehicle' },
            motorcycles: { name: 'Motorcycles', icon: 'üèçÔ∏è', color: '#ef4444', colorDark: '#b91c1c', type: 'vehicle' },
            planes: { name: 'Planes', icon: '‚úàÔ∏è', color: '#06b6d4', colorDark: '#0e7490', type: 'vehicle' },
            helicopters: { name: 'Helicopters', icon: 'üöÅ', color: '#8b5cf6', colorDark: '#6d28d9', type: 'vehicle' },
            boats: { name: 'Boats', icon: '‚õµ', color: '#0ea5e9', colorDark: '#0369a1', type: 'vehicle' },
            yachts: { name: 'Yachts', icon: 'üõ•Ô∏è', color: '#f59e0b', colorDark: '#b45309', type: 'vehicle' },
            submarines: { name: 'Submarines', icon: 'üõü', color: '#64748b', colorDark: '#334155', type: 'vehicle' },
            jetskis: { name: 'Jet Skis', icon: 'üåä', color: '#14b8a6', colorDark: '#0d9488', type: 'vehicle' },
            sailboats: { name: 'Sailboats', icon: '‚õµ', color: '#a855f7', colorDark: '#7c3aed', type: 'vehicle' },
            // Parts
            engineparts: { name: 'Engine Parts', icon: '‚öôÔ∏è', color: '#6b7280', colorDark: '#374151', type: 'part' },
            bodyparts: { name: 'Body Parts', icon: 'üö™', color: '#78716c', colorDark: '#44403c', type: 'part' },
            electronics: { name: 'Electronics', icon: 'üí°', color: '#eab308', colorDark: '#a16207', type: 'part' },
            tireswheels: { name: 'Tires & Wheels', icon: 'üõû', color: '#1e293b', colorDark: '#0f172a', type: 'part' },
            interiorparts: { name: 'Interior Parts', icon: 'üí∫', color: '#be185d', colorDark: '#9d174d', type: 'part' },
            exhaustparts: { name: 'Exhaust Parts', icon: 'üí®', color: '#525252', colorDark: '#262626', type: 'part' },
            // Other
            properties: { name: 'Properties', icon: 'üè†', color: '#10b981', colorDark: '#047857', type: 'other' },
            land: { name: 'Land', icon: 'üåç', color: '#84cc16', colorDark: '#4d7c0f', type: 'other' },
            rentals: { name: 'Rentals', icon: 'üîë', color: '#3b82f6', colorDark: '#1d4ed8', type: 'other' },
            auctions: { name: 'Live Auctions', icon: 'üî¥', color: '#ef4444', colorDark: '#dc2626', type: 'other' },
            dashboard: { name: 'Dashboard', icon: 'üìä', color: '#9333ea', colorDark: '#7c3aed', type: 'hidden' }
        };

        // Listings data by category (some have sellerRole for badge display)
        const listings = {
            cars: [
                { id: '1', title: '2023 Tesla Model 3', price: '$45,000', location: 'New York, NY', image: 'https://images.unsplash.com/photo-1560958089-b8a1929cea89?w=800&h=600&fit=crop', sellerRole: 'car-dealer', premium: true },
                { id: '2', title: '2022 BMW M3 Competition', price: '$65,000', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop', sellerRole: 'car-dealer', premium: true },
                { id: '3', title: '2024 Mercedes-AMG GT', price: '$125,000', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?w=800&h=600&fit=crop', sellerRole: 'car-dealer' },
                { id: '4', title: '2023 Porsche 911 Turbo S', price: '$185,000', location: 'San Francisco, CA', image: 'https://images.unsplash.com/photo-1614162692292-7ac56d7f7f1e?w=800&h=600&fit=crop' },
                { id: '5', title: '2022 Audi RS7', price: '$95,000', location: 'Chicago, IL', image: 'https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?w=800&h=600&fit=crop', sellerRole: 'car-dealer' },
                { id: '6', title: '2023 Ford Mustang GT', price: '$55,000', location: 'Dallas, TX', image: 'https://images.unsplash.com/photo-1584345604476-8ec5e12e42dd?w=800&h=600&fit=crop' }
            ],
            trucks: [
                { id: '7', title: '2023 Ford F-150 Raptor', price: '$72,000', location: 'Dallas, TX', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
                { id: '8', title: '2022 RAM 1500 TRX', price: '$85,000', location: 'Phoenix, AZ', image: 'https://images.unsplash.com/photo-1559416523-140ddc3d238c?w=800&h=600&fit=crop' },
                { id: '9', title: '2023 Chevrolet Silverado', price: '$58,000', location: 'Denver, CO', image: 'https://images.unsplash.com/photo-1552519507-da3b142c6e3d?w=800&h=600&fit=crop' },
                { id: '10', title: '2022 Toyota Tundra TRD', price: '$62,000', location: 'Seattle, WA', image: 'https://images.unsplash.com/photo-1625231334168-25d99d65ae8e?w=800&h=600&fit=crop' },
                { id: '11', title: '2023 GMC Sierra Denali', price: '$78,000', location: 'Houston, TX', image: 'https://images.unsplash.com/photo-1609630875171-b1321377ee65?w=800&h=600&fit=crop' }
            ],
            bikes: [
                { id: '12', title: 'Trek Domane SL 7', price: '$6,500', location: 'Portland, OR', image: 'https://images.unsplash.com/photo-1485965120184-e220f721d03e?w=800&h=600&fit=crop' },
                { id: '13', title: 'Specialized S-Works', price: '$12,000', location: 'Boulder, CO', image: 'https://images.unsplash.com/photo-1532298229144-0ec0c57515c7?w=800&h=600&fit=crop' },
                { id: '14', title: 'Canyon Aeroad CF SLX', price: '$8,500', location: 'San Diego, CA', image: 'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=800&h=600&fit=crop' },
                { id: '15', title: 'Giant Propel Advanced', price: '$5,200', location: 'Austin, TX', image: 'https://images.unsplash.com/photo-1505705694340-019e5d6e2eb5?w=800&h=600&fit=crop' }
            ],
            motorcycles: [
                { id: '16', title: 'Harley-Davidson Street Glide', price: '$28,000', location: 'Milwaukee, WI', image: 'https://images.unsplash.com/photo-1558981806-ec527fa84c39?w=800&h=600&fit=crop' },
                { id: '17', title: 'Ducati Panigale V4', price: '$25,000', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=800&h=600&fit=crop' },
                { id: '18', title: 'BMW S1000RR', price: '$22,000', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1609630875171-b1321377ee65?w=800&h=600&fit=crop' },
                { id: '19', title: 'Kawasaki Ninja ZX-10R', price: '$18,000', location: 'Atlanta, GA', image: 'https://images.unsplash.com/photo-1449426468159-d96dbf08f19f?w=800&h=600&fit=crop' }
            ],
            planes: [
                { id: '20', title: 'Cessna 172 Skyhawk', price: '$350,000', location: 'Van Nuys, CA', image: 'https://images.unsplash.com/photo-1540962351504-03099e0a754b?w=800&h=600&fit=crop' },
                { id: '21', title: 'Piper PA-28 Cherokee', price: '$180,000', location: 'Scottsdale, AZ', image: 'https://images.unsplash.com/photo-1559628233-100c798642d4?w=800&h=600&fit=crop' },
                { id: '22', title: 'Cirrus SR22', price: '$650,000', location: 'Dallas, TX', image: 'https://images.unsplash.com/photo-1474302770737-173ee21bab63?w=800&h=600&fit=crop' },
                { id: '23', title: 'Beechcraft Bonanza', price: '$450,000', location: 'Wichita, KS', image: 'https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=800&h=600&fit=crop' }
            ],
            helicopters: [
                { id: '24', title: 'Robinson R44 Raven II', price: '$485,000', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1534321238895-da3ab632df3e?w=800&h=600&fit=crop' },
                { id: '25', title: 'Bell 206 JetRanger', price: '$750,000', location: 'Houston, TX', image: 'https://images.unsplash.com/photo-1540575861501-7cf05a4b125a?w=800&h=600&fit=crop' },
                { id: '26', title: 'Eurocopter EC120', price: '$1,200,000', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1551649001-10a2b0459a24?w=800&h=600&fit=crop' }
            ],
            boats: [
                { id: '27', title: 'Boston Whaler 280 Outrage', price: '$285,000', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=800&h=600&fit=crop' },
                { id: '28', title: 'Sea Ray Sundancer 320', price: '$245,000', location: 'San Diego, CA', image: 'https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=800&h=600&fit=crop' },
                { id: '29', title: 'Grady-White Freedom 285', price: '$220,000', location: 'Tampa, FL', image: 'https://images.unsplash.com/photo-1605281317010-fe5ffe798166?w=800&h=600&fit=crop' },
                { id: '30', title: 'Bayliner VR6', price: '$65,000', location: 'Seattle, WA', image: 'https://images.unsplash.com/photo-1559825481-12a05cc00344?w=800&h=600&fit=crop' }
            ],
            yachts: [
                { id: '31', title: 'Azimut 55S', price: '$1,850,000', location: 'Fort Lauderdale, FL', image: 'https://images.unsplash.com/photo-1569263979104-865ab7cd8d13?w=800&h=600&fit=crop' },
                { id: '32', title: 'Sunseeker Predator 60', price: '$2,200,000', location: 'Monaco', image: 'https://images.unsplash.com/photo-1540946485063-a40da27545f8?w=800&h=600&fit=crop' },
                { id: '33', title: 'Princess V65', price: '$1,650,000', location: 'Miami Beach, FL', image: 'https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=800&h=600&fit=crop' }
            ],
            submarines: [
                { id: '34', title: 'Triton 3300/3 Submersible', price: '$5,500,000', location: 'Fort Lauderdale, FL', image: 'https://images.unsplash.com/photo-1544551763-77ef2d0cfc6c?w=800&h=600&fit=crop' },
                { id: '35', title: 'DeepFlight Super Falcon', price: '$1,700,000', location: 'San Francisco, CA', image: 'https://images.unsplash.com/photo-1518623001395-125242310d0c?w=800&h=600&fit=crop' }
            ],
            jetskis: [
                { id: '36', title: 'Yamaha WaveRunner FX', price: '$18,500', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1593351415075-3bac9f45c877?w=800&h=600&fit=crop' },
                { id: '37', title: 'Sea-Doo RXP-X 300', price: '$17,000', location: 'San Diego, CA', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
                { id: '38', title: 'Kawasaki Ultra 310LX', price: '$19,500', location: 'Tampa, FL', image: 'https://images.unsplash.com/photo-1600054800747-be294a6a0d26?w=800&h=600&fit=crop' }
            ],
            sailboats: [
                { id: '39', title: 'Beneteau Oceanis 40.1', price: '$320,000', location: 'Annapolis, MD', image: 'https://images.unsplash.com/photo-1500917293891-ef795e70e1f6?w=800&h=600&fit=crop' },
                { id: '40', title: 'Jeanneau Sun Odyssey 440', price: '$380,000', location: 'Newport, RI', image: 'https://images.unsplash.com/photo-1534854638093-bada1813ca19?w=800&h=600&fit=crop' },
                { id: '41', title: 'Catalina 425', price: '$295,000', location: 'San Francisco, CA', image: 'https://images.unsplash.com/photo-1532447245184-3c143daca348?w=800&h=600&fit=crop' }
            ],
            engineparts: [
                { id: '42', title: 'LS3 6.2L V8 Crate Engine', price: '$8,500', location: 'Detroit, MI', image: 'https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?w=800&h=600&fit=crop', sellerRole: 'mechanic' },
                { id: '43', title: 'Ford Coyote 5.0L Engine', price: '$7,200', location: 'Dearborn, MI', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop', sellerRole: 'mechanic' },
                { id: '44', title: 'Turbocharger Kit Universal', price: '$2,800', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1600054800747-be294a6a0d26?w=800&h=600&fit=crop', sellerRole: 'mechanic' },
                { id: '45', title: 'Performance Camshaft Set', price: '$850', location: 'Chicago, IL', image: 'https://images.unsplash.com/photo-1565689157206-0fddef7589a2?w=800&h=600&fit=crop' }
            ],
            bodyparts: [
                { id: '46', title: 'Carbon Fiber Hood BMW M3', price: '$1,200', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1544829099-b9a0c07fad1a?w=800&h=600&fit=crop' },
                { id: '47', title: 'Wide Body Kit Mustang', price: '$3,500', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
                { id: '48', title: 'OEM Front Bumper Porsche', price: '$2,100', location: 'Atlanta, GA', image: 'https://images.unsplash.com/photo-1602637824886-37c93e30d0ab?w=800&h=600&fit=crop' }
            ],
            electronics: [
                { id: '49', title: 'Alpine 12" Subwoofer', price: '$450', location: 'Nashville, TN', image: 'https://images.unsplash.com/photo-1545454675-3531b543be5d?w=800&h=600&fit=crop' },
                { id: '50', title: 'Pioneer CarPlay System', price: '$650', location: 'Austin, TX', image: 'https://images.unsplash.com/photo-1558618047-f4b511ce7ce7?w=800&h=600&fit=crop' },
                { id: '51', title: 'LED Headlight Conversion', price: '$380', location: 'Phoenix, AZ', image: 'https://images.unsplash.com/photo-1489824904134-891ab64532f1?w=800&h=600&fit=crop' }
            ],
            tireswheels: [
                { id: '52', title: 'Michelin Pilot Sport 4S Set', price: '$1,400', location: 'Charlotte, NC', image: 'https://images.unsplash.com/photo-1578844251758-2f71da64c96f?w=800&h=600&fit=crop' },
                { id: '53', title: 'BBS RS 19" Wheels', price: '$3,200', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
                { id: '54', title: 'Forgiato Custom 22" Set', price: '$8,500', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1611821064430-0d40291d0f0b?w=800&h=600&fit=crop' }
            ],
            interiorparts: [
                { id: '55', title: 'Recaro Sportster CS Seats', price: '$2,800', location: 'San Diego, CA', image: 'https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?w=800&h=600&fit=crop' },
                { id: '56', title: 'Custom Leather Steering Wheel', price: '$650', location: 'Dallas, TX', image: 'https://images.unsplash.com/photo-1558618047-f4b511ce7ce7?w=800&h=600&fit=crop' },
                { id: '57', title: 'Carbon Fiber Dash Kit', price: '$1,200', location: 'Atlanta, GA', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' }
            ],
            exhaustparts: [
                { id: '58', title: 'Borla Cat-Back Exhaust', price: '$1,400', location: 'Phoenix, AZ', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' },
                { id: '59', title: 'Akrapovic Titanium System', price: '$4,500', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?w=800&h=600&fit=crop' },
                { id: '60', title: 'Flowmaster Super 44 Muffler', price: '$280', location: 'Houston, TX', image: 'https://images.unsplash.com/photo-1565689157206-0fddef7589a2?w=800&h=600&fit=crop' }
            ],
            properties: [
                { id: '61', title: 'Modern Downtown Apartment', price: '$450,000', location: 'Manhattan, NY', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&h=600&fit=crop', sellerRole: 'realtor', premium: true },
                { id: '62', title: 'Luxury Beachfront Villa', price: '$1,250,000', location: 'Malibu, CA', image: 'https://images.unsplash.com/photo-1613977257363-707ba9348227?w=800&h=600&fit=crop', sellerRole: 'realtor', premium: true },
                { id: '63', title: 'Cozy Mountain Cabin', price: '$320,000', location: 'Aspen, CO', image: 'https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=800&h=600&fit=crop' },
                { id: '64', title: 'Penthouse Suite', price: '$2,800,000', location: 'Beverly Hills, CA', image: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800&h=600&fit=crop', sellerRole: 'realtor', premium: true },
                { id: '65', title: 'Suburban Family Home', price: '$580,000', location: 'Austin, TX', image: 'https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&h=600&fit=crop', sellerRole: 'realtor' },
                { id: '66', title: 'Historic Brownstone', price: '$1,100,000', location: 'Boston, MA', image: 'https://images.unsplash.com/photo-1605276374104-dee2a0ed3cd6?w=800&h=600&fit=crop' }
            ],
            land: [
                { id: '67', title: '10 Acres Ranch Land', price: '$250,000', location: 'Montana', image: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=800&h=600&fit=crop' },
                { id: '68', title: '5 Acres Lakefront Property', price: '$180,000', location: 'Minnesota', image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop' },
                { id: '69', title: '20 Acres Farm Land', price: '$320,000', location: 'Texas', image: 'https://images.unsplash.com/photo-1500076656116-558758c991c1?w=800&h=600&fit=crop' },
                { id: '70', title: '2 Acres Mountain View', price: '$150,000', location: 'Colorado', image: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800&h=600&fit=crop' },
                { id: '71', title: '15 Acres Desert Land', price: '$95,000', location: 'Arizona', image: 'https://images.unsplash.com/photo-1509316785289-025f5b846b35?w=800&h=600&fit=crop' }
            ],
            auctions: [
                { id: 'a1', title: '2008 BMW 328i', image: 'https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop', currentBid: 8200, timeLeft: 7967, isAuction: true },
                { id: 'a2', title: '3-Bed Lake House', image: 'https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=800&h=600&fit=crop', currentBid: 245000, timeLeft: 4523, isAuction: true },
                { id: 'a3', title: 'Yacht Slip Rental', image: 'https://images.unsplash.com/photo-1569263979104-865ab7cd8d13?w=800&h=600&fit=crop', currentBid: 15800, timeLeft: 1847, isAuction: true }
            ],
            rentals: [
                { id: '72', title: '2024 BMW X5 - Weekly Rental', price: '$450/week', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1555215695-3004980ad54e?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'rent-cars', sellerRole: 'car-dealer' },
                { id: '73', title: 'Luxury Condo - Monthly Lease', price: '$3,500/month', location: 'Manhattan, NY', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'lease-property', sellerRole: 'realtor' },
                { id: '74', title: 'Beach House - Vacation Rental', price: '$250/night', location: 'Malibu, CA', image: 'https://images.unsplash.com/photo-1613977257363-707ba9348227?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'short-term', sellerRole: 'realtor' },
                { id: '75', title: '5 Acres Farmland - Annual Lease', price: '$12,000/year', location: 'Texas', image: 'https://images.unsplash.com/photo-1500076656116-558758c991c1?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'lease-land' },
                { id: '76', title: 'Tesla Model 3 - Daily Rental', price: '$89/day', location: 'Los Angeles, CA', image: 'https://images.unsplash.com/photo-1560958089-b8a1929cea89?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'rent-cars', sellerRole: 'car-dealer' },
                { id: '77', title: 'Yacht Charter - Weekend', price: '$5,000/weekend', location: 'Fort Lauderdale, FL', image: 'https://images.unsplash.com/photo-1569263979104-865ab7cd8d13?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'lease-boats' },
                { id: '78', title: 'Speedboat - Daily Rental', price: '$350/day', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'lease-boats' },
                { id: '79', title: 'Downtown Office Space - Lease', price: '$8,500/month', location: 'Chicago, IL', image: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'lease-property', sellerRole: 'realtor' },
                { id: '80', title: 'Cozy Cabin - Weekly Rental', price: '$800/week', location: 'Aspen, CO', image: 'https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=800&h=600&fit=crop', listingType: 'rent', rentalSubType: 'short-term' }
            ]
        };

        // Current active category
        let activeCategory = 'cars';
        
        // Search query state (like useState)
        let searchQuery = '';
        
        // Premium status (check localStorage)
        let isPremiumUser = localStorage.getItem('isPremiumUser') === 'true';
        
        // User login state
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        let currentUser = localStorage.getItem('currentUser') || 'John';
        
        // User's listings (for dashboard)
        let myListings = [
            { id: 'my1', title: '2019 Honda Civic', price: '$18,500', location: 'Austin, TX', image: 'https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?w=800&h=600&fit=crop', category: 'cars' },
            { id: 'my2', title: 'Downtown Studio Apt', price: '$225,000', location: 'Seattle, WA', image: 'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&h=600&fit=crop', category: 'properties' },
            { id: 'my3', title: 'Jet Ski - Like New', price: '$12,000', location: 'Miami, FL', image: 'https://images.unsplash.com/photo-1593351415075-3bac9f45c877?w=800&h=600&fit=crop', category: 'jetskis' }
        ];
        
        // Area Legends data (embedded from areaLegends.json)
        const areaLegends = {
            "Montana": {
                title: "Big Sky Country Secrets",
                icon: "üèîÔ∏è",
                content: "Legend says the Shoshone people called this land 'The Backbone of the World.' Gold miners in 1862 swore they saw ghost riders in the Crazy Mountains‚Äîspirits of fallen warriors still hunting phantom buffalo.\n\nFact: Montana has more cattle than people. Population? Just over 1 million in a state bigger than Japan. The Northern Lights dance here 200 nights a year.\n\nDark secret: The town of Garnet sits abandoned since 1912. Visitors report hearing piano music from the empty saloon at midnight. Ranch land here sells for $3,000 an acre‚Äîbut old-timers won't touch the plots near Bannack.\n\nAverage winter temp: -20¬∞F. Average summer temp: Perfect."
            },
            "Minnesota": {
                title: "Land of 10,000 Lakes (and Secrets)",
                icon: "üå≤",
                content: "Legend says Lake Superior's monster, Misshepeshu‚Äîthe great lynx spirit‚Äîhaunts these shores. Ojibwe elders warn: never point at the lake, or the water panther will drag you under. Locals swear they hear drums when storms roll in.\n\nFact: The 1890s timber boom left ghost towns scattered through the Northwoods. Those abandoned cabins? Now rent for $500/night to 'glampers.' Population of the Iron Range: dropping fast. Average snowfall? 100+ inches.\n\nThe SS Edmund Fitzgerald went down here in '75 with 29 souls. On stormy nights, freighter captains still radio warnings to... something.\n\nLand prices: $2,500/acre near the Boundary Waters. Worth every frozen penny."
            },
            "Texas": {
                title: "Everything's Bigger‚ÄîIncluding the Mysteries",
                icon: "ü§†",
                content: "Legend has it: The Marfa Lights have danced across the desert since the 1880s. Apache warriors said they were stars that fell to earth. Scientists say 'car headlights.' Locals say scientists haven't been there at 3 AM.\n\nFact: King Ranch is bigger than Rhode Island. Texas was its own country for 9 years. There are more miles of road here than any other state‚Äîsome lead to towns that don't exist on maps anymore.\n\nThe Chihuahuan Desert hides 'The Devil's Sinkhole'‚Äîa 400-foot pit where 3 million bats swirl out every sunset. Ranchers in 1867 thought it was a portal to hell.\n\nFarm land: $1,800/acre. Oil rights not included. Population: 30 million and growing."
            },
            "Colorado": {
                title: "Mile High Mysteries",
                icon: "‚õ∞Ô∏è",
                content: "Legend tells of the Tommyknockers‚Äîspirits of dead miners who knock on tunnel walls to warn of cave-ins. Or to lure you deeper. The miners of Cripple Creek left offerings of food for them. Smart men.\n\nFact: Colorado has 58 peaks over 14,000 feet. The Ute people called them 'the shining mountains.' Gold was discovered here in 1858, and within a year, 100,000 people flooded in. Most went home broke.\n\nStanley Hotel in Estes Park inspired Stephen King's 'The Shining.' Room 217 is perpetually booked‚Äîby the living and otherwise.\n\nMountain land: $5,000-50,000/acre depending on how close to the haunted hotels. Average sunny days: 300. Average ghost sightings: unconfirmed."
            },
            "Arizona": {
                title: "Desert of Lost Souls",
                icon: "üåµ",
                content: "Legend speaks of the Lost Dutchman's Gold Mine in the Superstition Mountains. Jacob Waltz found it in 1891 and took the secret to his grave. Since then, 600+ treasure hunters have died searching. The Apache say the Thunder God guards it.\n\nFact: Arizona has more species of scorpions than any other state‚Äî60 and counting. The Grand Canyon is 6 million years old. Tombstone's Boothill Cemetery holds 250 souls, mostly killed by gunfire.\n\nThe town of Jerome was built on a 30-degree slope. It's sliding downhill. The old hospital is now a hotel‚Äîguests report surgeries still happening at night.\n\nDesert land: $800/acre. Water rights: priceless. Summer temps: 115¬∞F in the shade (if you can find any)."
            },
            "Oregon": {
                title: "Pacific Northwest Phantoms",
                icon: "üå≤",
                content: "Legend warns of Bandage Man‚Äîa figure wrapped in bloody gauze who jumps onto trucks near Cannon Beach since the 1960s. Loggers whisper of 'The Green Man' deep in the old growth forest‚Äînature's vengeance on clear-cutters.\n\nFact: Oregon has more ghost towns than any Western state‚Äîover 200. The 1880s gold rush came and went, leaving empty saloons and echoing mine shafts.\n\nCrater Lake is 1,943 feet deep‚Äîthe deepest in America. The Klamath people say the spirit Llao lives at the bottom. Scientists found a 30-foot 'Old Man' log that's been floating vertically for 120+ years. No explanation.\n\nTimber land: $4,000/acre. Rainfall: 37 inches. Bigfoot sightings: 120+ per year (just saying)."
            }
        };

        // Dashboard analytics data
        const dashboardData = {
            earnings: 4200,
            monthlyEarnings: [320, 580, 420, 890, 650, 1340],
            months: ['Aug', 'Sep', 'Oct', 'Nov', 'Dec', 'Jan'],
            views: 84,
            likes: 12,
            chats: 5
        };
        
        // Update login UI
        function updateLoginUI() {
            const loggedOutLinks = document.getElementById('logged-out-links');
            const loggedInLinks = document.getElementById('logged-in-links');
            const userBadge = document.getElementById('user-badge');
            
            if (isLoggedIn) {
                loggedOutLinks.style.display = 'none';
                loggedInLinks.style.display = 'flex';
                userBadge.textContent = `üë§ ${currentUser}`;
            } else {
                loggedOutLinks.style.display = 'flex';
                loggedInLinks.style.display = 'none';
            }
        }
        
        function goToDashboard() {
            activeCategory = 'dashboard';
            searchQuery = '';
            document.getElementById('search-input').value = '';
            document.getElementById('search-clear').classList.remove('visible');
            
            // Update sidebar active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                item.style.background = '';
            });
            
            renderListings();
        }
        
        function logout() {
            isLoggedIn = false;
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            updateLoginUI();
            activeCategory = 'cars';
            renderListings();
        }
        
        function renderDashboard() {
            const grid = document.getElementById('listings-grid');
            const maxEarning = Math.max(...dashboardData.monthlyEarnings);
            
            grid.innerHTML = `
                <div class="dashboard-container">
                    <div class="dashboard-header">
                        <h1 class="dashboard-title">Welcome back, ${currentUser}! üëã</h1>
                        <p class="dashboard-subtitle">Here's what's happening with your listings</p>
                    </div>
                    
                    <div class="dashboard-grid">
                        <!-- My Listings Column -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">üì¶ My Listings</span>
                                <span class="dashboard-card-icon">${myListings.length}</span>
                            </div>
                            <div id="my-listings-container">
                                ${myListings.map(listing => `
                                    <div class="my-listing-card" id="listing-${listing.id}">
                                        <img src="${listing.image}" alt="${listing.title}" class="my-listing-image" />
                                        <div class="my-listing-info">
                                            <div class="my-listing-title">${listing.title}</div>
                                            <div class="my-listing-price">${listing.price}</div>
                                        </div>
                                        <div class="my-listing-actions">
                                            <button class="listing-action-btn edit" onclick="editListing('${listing.id}')">‚úèÔ∏è Edit</button>
                                            <button class="listing-action-btn delete" onclick="deleteListing('${listing.id}')">üóëÔ∏è</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Earnings Column -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">üí∞ Earnings</span>
                                <span class="dashboard-card-icon">üìà</span>
                            </div>
                            <div class="earnings-total">$${dashboardData.earnings.toLocaleString()}</div>
                            <div class="bar-graph">
                                ${dashboardData.monthlyEarnings.map((earning, i) => `
                                    <div class="bar-container">
                                        <div class="bar" style="height: ${(earning / maxEarning) * 120}px;">
                                            <span class="bar-value">$${earning}</span>
                                        </div>
                                        <span class="bar-label">${dashboardData.months[i]}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Analytics Column -->
                        <div class="dashboard-card">
                            <div class="dashboard-card-header">
                                <span class="dashboard-card-title">üìä Analytics</span>
                                <span class="dashboard-card-icon">Today</span>
                            </div>
                            <div class="analytics-grid">
                                <div class="analytics-item">
                                    <span class="analytics-icon">üëÅÔ∏è</span>
                                    <div class="analytics-info">
                                        <div class="analytics-value">${dashboardData.views}</div>
                                        <div class="analytics-label">Views today</div>
                                    </div>
                                </div>
                                <div class="analytics-item">
                                    <span class="analytics-icon">‚ù§Ô∏è</span>
                                    <div class="analytics-info">
                                        <div class="analytics-value">${dashboardData.likes}</div>
                                        <div class="analytics-label">Likes</div>
                                    </div>
                                </div>
                                <div class="analytics-item">
                                    <span class="analytics-icon">üí¨</span>
                                    <div class="analytics-info">
                                        <div class="analytics-value">${dashboardData.chats}</div>
                                        <div class="analytics-label">Chats</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add New Listing Button -->
                    <button class="dashboard-add-btn" onclick="openDashboardPostForm()">
                        ‚ûï Add New Listing
                    </button>
                </div>
            `;
        }
        
        function editListing(id) {
            const listing = myListings.find(l => l.id === id);
            if (!listing) return;
            
            document.getElementById('edit-listing-id').value = id;
            document.getElementById('edit-listing-title').value = listing.title;
            document.getElementById('edit-listing-price').value = listing.price;
            document.getElementById('edit-listing-location').value = listing.location;
            
            openModal('editListing');
        }
        
        function saveListingEdit() {
            const id = document.getElementById('edit-listing-id').value;
            const listing = myListings.find(l => l.id === id);
            if (!listing) return;
            
            listing.title = document.getElementById('edit-listing-title').value;
            listing.price = document.getElementById('edit-listing-price').value;
            listing.location = document.getElementById('edit-listing-location').value;
            
            closeModal('editListing');
            renderDashboard();
            alert('‚úÖ Listing updated successfully!');
        }
        
        function deleteListing(id) {
            if (!confirm('Are you sure you want to delete this listing?')) return;
            
            myListings = myListings.filter(l => l.id !== id);
            
            const el = document.getElementById(`listing-${id}`);
            if (el) {
                el.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => renderDashboard(), 300);
            }
            
            alert('üóëÔ∏è Listing deleted!');
        }
        
        function openDashboardPostForm() {
            // Pre-fill seller as current user
            document.getElementById('listing-title').value = '';
            document.getElementById('listing-price').value = '';
            document.getElementById('listing-location').value = '';
            openModal('postListing');
        }

        // Area Legends functions
        let currentLegendLocation = '';

        function showAreaLegend(location) {
            // Extract state from location string
            const parts = location.split(',').map(s => s.trim());
            const state = parts[parts.length - 1] || parts[0];
            currentLegendLocation = location;
            
            // Find matching legend
            const legend = areaLegends[state] || generateDefaultLegend(state, location);
            
            // Update modal content
            document.getElementById('legends-location').textContent = location;
            document.getElementById('legends-icon').textContent = legend.icon;
            document.getElementById('legends-title').textContent = legend.title;
            document.getElementById('legends-text').textContent = legend.content;
            
            openModal('legends');
        }

        function generateDefaultLegend(state, location) {
            // Generate a default legend for unknown locations
            const icons = ['üèîÔ∏è', 'üå≤', 'üåæ', 'üèúÔ∏è', 'üåä', '‚õ∞Ô∏è', 'ü¶å', 'üåª'];
            const randomIcon = icons[Math.floor(Math.random() * icons.length)];
            
            return {
                title: `Secrets of ${state}`,
                icon: randomIcon,
                content: `The land around ${location} holds stories older than memory. Indigenous peoples walked these grounds for thousands of years before the first settlers arrived, leaving behind petroglyphs and burial mounds that archaeologists still puzzle over.\n\nFact: This region experiences unique microclimates that support wildlife found nowhere else. Old-timers speak of hidden springs and caves that never made it onto any map.\n\nLocal lore mentions strange lights seen on moonless nights, and there's at least one abandoned homestead nearby where 'something happened' that nobody talks about anymore.\n\nLand values here have doubled in the past decade. Some say it's development pressure. Others whisper it's people from the cities, running from something‚Äîlooking for a place to disappear.\n\nWhatever drew you here, the land has a way of keeping its own secrets. And its own counsel.`
            };
        }

        function shareLegend() {
            const text = `üèîÔ∏è Did you know? Check out the legends of ${currentLegendLocation}! Found on Treazure Yaad.`;
            if (navigator.share) {
                navigator.share({ title: 'Area Legends', text: text });
            } else {
                navigator.clipboard.writeText(text);
                alert('üìã Legend info copied to clipboard!');
            }
        }

        // ===== COMPARE FUNCTIONALITY =====
        
        let compareMode = false;
        let compareItems = JSON.parse(localStorage.getItem('compareItems')) || [];
        const MAX_COMPARE = 4;

        // Sample perks for listings
        const listingPerks = {
            cars: ['Leather Seats', 'Sunroof', 'EV Ready', 'Apple CarPlay', 'Heated Seats', 'Backup Camera', 'Low Miles', 'One Owner'],
            trucks: ['4WD', 'Tow Package', 'Bed Liner', 'Off-Road Ready', 'Crew Cab', 'Diesel', 'Heavy Duty'],
            properties: ['Ocean View', 'Pool', 'Updated Kitchen', 'Smart Home', 'Garage', 'Fireplace', 'New Roof', 'Solar Panels'],
            land: ['Lake Access', 'Mountain View', 'Timber Rights', 'Mineral Rights', 'Road Access', 'Utilities Ready', 'Fenced'],
            boats: ['Low Hours', 'Twin Engine', 'GPS', 'Fish Finder', 'Fresh Water Only', 'Trailer Included'],
            motorcycles: ['ABS', 'Custom Paint', 'Low Miles', 'Quick Shifter', 'Cruise Control', 'Heated Grips']
        };

        function toggleCompareMode() {
            compareMode = !compareMode;
            const btn = document.getElementById('compare-toggle-btn');
            const btnText = document.getElementById('compare-btn-text');
            const grid = document.getElementById('listings-grid');
            
            if (compareMode) {
                btn.classList.add('active');
                btnText.textContent = 'Exit Compare';
                grid?.classList.add('compare-mode');
            } else {
                btn.classList.remove('active');
                btnText.textContent = 'Compare';
                grid?.classList.remove('compare-mode');
            }
            
            updateCompareBar();
        }

        function toggleCompareItem(listing) {
            const existingIndex = compareItems.findIndex(item => item.id === listing.id);
            
            if (existingIndex > -1) {
                // Remove item
                compareItems.splice(existingIndex, 1);
            } else if (compareItems.length < MAX_COMPARE) {
                // Add item with extra data
                const category = listing.categoryKey || activeCategory;
                const perks = getRandomPerks(category);
                const specs = generateSpecs(listing, category);
                
                compareItems.push({
                    ...listing,
                    categoryKey: category,
                    perks: perks,
                    specs: specs
                });
            } else {
                alert(`Maximum ${MAX_COMPARE} items for comparison`);
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('compareItems', JSON.stringify(compareItems));
            updateCompareBar();
            renderListings();
        }

        function getRandomPerks(category) {
            const categoryPerks = listingPerks[category] || listingPerks.cars;
            const shuffled = [...categoryPerks].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, 3);
        }

        function generateSpecs(listing, category) {
            if (['properties', 'land'].includes(category)) {
                return {
                    type: 'property',
                    beds: Math.floor(Math.random() * 4) + 1,
                    baths: Math.floor(Math.random() * 3) + 1,
                    sqft: (Math.floor(Math.random() * 3000) + 800).toLocaleString()
                };
            } else {
                return {
                    type: 'vehicle',
                    seats: Math.floor(Math.random() * 5) + 2,
                    year: 2018 + Math.floor(Math.random() * 7),
                    miles: (Math.floor(Math.random() * 80000) + 5000).toLocaleString()
                };
            }
        }

        function updateCompareBar() {
            const bar = document.getElementById('compare-bar');
            const count = document.getElementById('compare-bar-count');
            const items = document.getElementById('compare-bar-items');
            
            count.textContent = `${compareItems.length}/${MAX_COMPARE} selected`;
            
            items.innerHTML = compareItems.map(item => 
                `<img src="${item.image}" alt="${item.title}" class="compare-bar-thumb" />`
            ).join('');
            
            if (compareItems.length > 0) {
                bar.classList.add('visible');
            } else {
                bar.classList.remove('visible');
            }
        }

        function clearCompare() {
            compareItems = [];
            localStorage.removeItem('compareItems');
            updateCompareBar();
            renderListings();
        }

        function openCompareView() {
            if (compareItems.length < 2) {
                alert('Please select at least 2 items to compare');
                return;
            }
            
            activeCategory = 'compare';
            renderListings();
        }

        function renderCompareView() {
            const grid = document.getElementById('listings-grid');
            const cols = compareItems.length;
            
            // Find cheapest
            const prices = compareItems.map(item => parsePrice(item.price));
            const minPrice = Math.min(...prices);
            
            grid.innerHTML = `
                <div class="compare-view" style="--compare-cols: ${cols}">
                    <div class="compare-header">
                        <h1 class="compare-title">‚öñÔ∏è Compare ${cols} Items</h1>
                        <div class="compare-actions">
                            <button class="compare-back-btn" onclick="exitCompareView()">‚Üê Back to Listings</button>
                            <button class="compare-pdf-btn" onclick="saveAsPDF()">üìÑ Save as PDF</button>
                        </div>
                    </div>
                    
                    <div class="compare-table">
                        <!-- Image Row -->
                        <div class="compare-row">
                            <div class="compare-row-label">Item</div>
                            ${compareItems.map((item, i) => `
                                <div class="compare-cell compare-cell-image ${prices[i] === minPrice ? 'cheapest' : ''}">
                                    <img src="${item.image}" alt="${item.title}" />
                                    <div class="compare-cell-title">${item.title}</div>
                                    <button class="compare-remove-btn" onclick="removeFromCompare('${item.id}')">‚úï Remove</button>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Price Row -->
                        <div class="compare-row">
                            <div class="compare-row-label">Price</div>
                            ${compareItems.map((item, i) => `
                                <div class="compare-cell ${prices[i] === minPrice ? 'cheapest' : ''}">
                                    <span class="compare-cell-price ${prices[i] === minPrice ? 'cheapest-price' : ''}">${item.price}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Location Row -->
                        <div class="compare-row">
                            <div class="compare-row-label">Location</div>
                            ${compareItems.map(item => `
                                <div class="compare-cell">
                                    <span class="compare-cell-location">üìç ${item.location}</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Specs Row -->
                        <div class="compare-row">
                            <div class="compare-row-label">${compareItems[0]?.specs?.type === 'property' ? 'Details' : 'Specs'}</div>
                            ${compareItems.map(item => `
                                <div class="compare-cell">
                                    <div class="compare-cell-specs">
                                        ${item.specs?.type === 'property' ? `
                                            <span class="compare-spec">üõèÔ∏è ${item.specs.beds} Beds</span>
                                            <span class="compare-spec">üõÅ ${item.specs.baths} Baths</span>
                                            <span class="compare-spec">üìê ${item.specs.sqft} sq ft</span>
                                        ` : `
                                            <span class="compare-spec">üí∫ ${item.specs?.seats || 5} Seats</span>
                                            <span class="compare-spec">üìÖ ${item.specs?.year || 2022}</span>
                                            <span class="compare-spec">üõ£Ô∏è ${item.specs?.miles || '25,000'} mi</span>
                                        `}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Perks Row -->
                        <div class="compare-row">
                            <div class="compare-row-label">Key Perks</div>
                            ${compareItems.map((item, i) => `
                                <div class="compare-cell">
                                    <div class="compare-perks">
                                        ${(item.perks || ['Great Value']).map((perk, pi) => 
                                            `<span class="compare-perk ${pi === 0 ? 'highlight' : ''}">${perk}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function removeFromCompare(id) {
            compareItems = compareItems.filter(item => item.id !== id);
            localStorage.setItem('compareItems', JSON.stringify(compareItems));
            
            if (compareItems.length < 2) {
                exitCompareView();
            } else {
                renderCompareView();
            }
            updateCompareBar();
        }

        function exitCompareView() {
            activeCategory = 'cars';
            renderListings();
        }

        function saveAsPDF() {
            alert('üìÑ Preparing PDF...\n\nIn production, this would generate a PDF using a library like jsPDF or html2pdf.\n\nFor now, you can use Ctrl+P (Cmd+P) to print/save as PDF!');
            window.print();
        }

        function isItemInCompare(id) {
            return compareItems.some(item => item.id === id);
        }

        // ===== 360¬∞ TOUR FUNCTIONALITY =====
        
        // Panorama images for different categories
        const tourPanoramas = {
            cars: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=4000&h=1500&fit=crop',
            trucks: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=4000&h=1500&fit=crop',
            properties: 'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=4000&h=1500&fit=crop',
            land: 'https://images.unsplash.com/photo-1500382017468-9049fed747ef?w=4000&h=1500&fit=crop',
            boats: 'https://images.unsplash.com/photo-1569263979104-865ab7cd8d13?w=4000&h=1500&fit=crop',
            yachts: 'https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=4000&h=1500&fit=crop'
        };

        // Hotspots for different categories
        const tourHotspots = {
            cars: [
                { x: 15, y: 50, icon: 'üîß', label: 'Engine Bay', image: 'https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?w=800&h=600&fit=crop' },
                { x: 40, y: 60, icon: 'üí∫', label: 'Interior', image: 'https://images.unsplash.com/photo-1503376780353-7e6692767b70?w=800&h=600&fit=crop' },
                { x: 65, y: 50, icon: 'üõû', label: 'Wheels', image: 'https://images.unsplash.com/photo-1611821064430-0d40291d0f0b?w=800&h=600&fit=crop' },
                { x: 85, y: 55, icon: 'üì¶', label: 'Trunk', image: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=800&h=600&fit=crop' }
            ],
            properties: [
                { x: 10, y: 45, icon: 'üç≥', label: 'Kitchen', image: 'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=800&h=600&fit=crop' },
                { x: 35, y: 50, icon: 'üõãÔ∏è', label: 'Living Room', image: 'https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=800&h=600&fit=crop' },
                { x: 60, y: 40, icon: 'üõèÔ∏è', label: 'Master Bedroom', image: 'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=800&h=600&fit=crop' },
                { x: 85, y: 55, icon: 'üå≥', label: 'Backyard', image: 'https://images.unsplash.com/photo-1558904541-efa843a96f01?w=800&h=600&fit=crop' }
            ],
            land: [
                { x: 20, y: 50, icon: 'üèîÔ∏è', label: 'Mountain View', image: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=800&h=600&fit=crop' },
                { x: 45, y: 45, icon: 'üå≤', label: 'Forest Area', image: 'https://images.unsplash.com/photo-1448375240586-882707db888b?w=800&h=600&fit=crop' },
                { x: 70, y: 55, icon: 'üíß', label: 'Water Access', image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop' },
                { x: 90, y: 50, icon: 'üöó', label: 'Road Access', image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop' }
            ],
            boats: [
                { x: 15, y: 50, icon: '‚öì', label: 'Bow', image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=800&h=600&fit=crop' },
                { x: 40, y: 55, icon: 'üéõÔ∏è', label: 'Helm', image: 'https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=800&h=600&fit=crop' },
                { x: 65, y: 45, icon: 'üõèÔ∏è', label: 'Cabin', image: 'https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=800&h=600&fit=crop' },
                { x: 85, y: 50, icon: 'üèä', label: 'Swim Platform', image: 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=800&h=600&fit=crop' }
            ]
        };

        let tourPanX = -33;
        let tourDragging = false;
        let tourStartX = 0;
        let tourStartPanX = 0;
        let currentTourCategory = 'cars';

        function openTour(title, category, isPremiumListing) {
            // Check if user can access tour
            if (!isPremiumUser && !isPremiumListing) {
                openModal('pricing');
                return;
            }

            currentTourCategory = category;
            const viewer = document.getElementById('tour-viewer');
            const panorama = document.getElementById('tour-panorama');
            const container = document.getElementById('tour-container');
            
            // Set panorama image
            panorama.src = tourPanoramas[category] || tourPanoramas.cars;
            document.getElementById('tour-title').textContent = `360¬∞ Tour: ${title}`;
            
            // Reset pan position
            tourPanX = -33;
            panorama.style.setProperty('--pan-x', tourPanX + '%');
            
            // Add hotspots
            const hotspots = tourHotspots[category] || tourHotspots.cars;
            const existingHotspots = container.querySelectorAll('.hotspot');
            existingHotspots.forEach(h => h.remove());
            
            hotspots.forEach((spot, i) => {
                const hotspot = document.createElement('div');
                hotspot.className = 'hotspot';
                hotspot.style.left = spot.x + '%';
                hotspot.style.top = spot.y + '%';
                hotspot.innerHTML = `${spot.icon}<span class="hotspot-label">${spot.label}</span>`;
                hotspot.onclick = (e) => {
                    e.stopPropagation();
                    showHotspotZoom(spot.label, spot.image);
                };
                container.appendChild(hotspot);
            });
            
            // Show viewer
            viewer.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Setup drag handlers
            setupTourDrag();
        }

        function closeTour() {
            document.getElementById('tour-viewer').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function setupTourDrag() {
            const container = document.getElementById('tour-container');
            const panorama = document.getElementById('tour-panorama');
            
            // Mouse events
            container.onmousedown = (e) => {
                tourDragging = true;
                tourStartX = e.clientX;
                tourStartPanX = tourPanX;
                container.style.cursor = 'grabbing';
            };
            
            document.onmousemove = (e) => {
                if (!tourDragging) return;
                const deltaX = e.clientX - tourStartX;
                const sensitivity = 0.05;
                tourPanX = tourStartPanX + (deltaX * sensitivity);
                tourPanX = Math.max(-66, Math.min(0, tourPanX));
                panorama.style.setProperty('--pan-x', tourPanX + '%');
            };
            
            document.onmouseup = () => {
                tourDragging = false;
                container.style.cursor = 'grab';
            };
            
            // Touch events for mobile
            container.ontouchstart = (e) => {
                tourDragging = true;
                tourStartX = e.touches[0].clientX;
                tourStartPanX = tourPanX;
            };
            
            container.ontouchmove = (e) => {
                if (!tourDragging) return;
                const deltaX = e.touches[0].clientX - tourStartX;
                const sensitivity = 0.1;
                tourPanX = tourStartPanX + (deltaX * sensitivity);
                tourPanX = Math.max(-66, Math.min(0, tourPanX));
                panorama.style.setProperty('--pan-x', tourPanX + '%');
            };
            
            container.ontouchend = () => {
                tourDragging = false;
            };
        }

        function showHotspotZoom(title, image) {
            document.getElementById('hotspot-zoom-title').textContent = title;
            document.getElementById('hotspot-zoom-image').src = image;
            document.getElementById('hotspot-zoom').classList.add('active');
        }

        function closeHotspotZoom() {
            document.getElementById('hotspot-zoom').classList.remove('active');
        }

        function goToHotspot(index) {
            const hotspots = tourHotspots[currentTourCategory] || tourHotspots.cars;
            if (hotspots[index]) {
                const targetX = -(hotspots[index].x * 0.66);
                tourPanX = Math.max(-66, Math.min(0, targetX));
                document.getElementById('tour-panorama').style.setProperty('--pan-x', tourPanX + '%');
                
                // Update nav dots
                document.querySelectorAll('.tour-nav-dot').forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });
            }
        }

        // Close tour on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeTour();
                closeHotspotZoom();
                closeAdminModal();
            }
        });

        // ===== ADMIN DASHBOARD =====
        
        let lastAdminAction = 'None yet';
        
        // Fake admin data (in production, load from adminData.json)
        const adminData = {
            users: [
                { id: 'u1', email: 'john.smith@email.com', role: 'Car Dealer', joined: '2025-11-15', status: 'active' },
                { id: 'u2', email: 'sarah.jones@realty.com', role: 'Realtor', joined: '2025-11-18', status: 'active' },
                { id: 'u3', email: 'mike.brown@gmail.com', role: 'Mechanic', joined: '2025-11-22', status: 'active' },
                { id: 'u4', email: 'emily.davis@outlook.com', role: 'Realtor', joined: '2025-12-01', status: 'active' },
                { id: 'u5', email: 'carlos.martinez@cars.net', role: 'Car Dealer', joined: '2025-12-05', status: 'active' },
                { id: 'u6', email: 'jennifer.wilson@homes.co', role: 'Realtor', joined: '2025-12-08', status: 'banned' },
                { id: 'u7', email: 'david.lee@autofix.com', role: 'Mechanic', joined: '2025-12-10', status: 'active' },
                { id: 'u8', email: 'amanda.taylor@email.com', role: 'Appliance Seller', joined: '2025-12-12', status: 'active' },
                { id: 'u9', email: 'robert.johnson@dealer.com', role: 'Car Dealer', joined: '2025-12-15', status: 'active' },
                { id: 'u10', email: 'lisa.anderson@realty.com', role: 'Realtor', joined: '2025-12-18', status: 'active' },
                { id: 'u11', email: 'james.thomas@gmail.com', role: 'Other', joined: '2025-12-20', status: 'active' },
                { id: 'u12', email: 'maria.garcia@hotmail.com', role: 'Realtor', joined: '2025-12-22', status: 'active' },
                { id: 'u13', email: 'william.moore@cars.com', role: 'Car Dealer', joined: '2025-12-25', status: 'banned' },
                { id: 'u14', email: 'patricia.white@email.com', role: 'Mechanic', joined: '2025-12-28', status: 'active' },
                { id: 'u15', email: 'richard.harris@outlook.com', role: 'Realtor', joined: '2026-01-02', status: 'active' },
                { id: 'u16', email: 'susan.clark@realty.co', role: 'Realtor', joined: '2026-01-04', status: 'active' },
                { id: 'u17', email: 'joseph.lewis@autos.net', role: 'Car Dealer', joined: '2026-01-06', status: 'active' },
                { id: 'u18', email: 'nancy.walker@gmail.com', role: 'Appliance Seller', joined: '2026-01-08', status: 'active' },
                { id: 'u19', email: 'thomas.hall@email.com', role: 'Mechanic', joined: '2026-01-10', status: 'active' },
                { id: 'u20', email: 'karen.allen@homes.com', role: 'Realtor', joined: '2026-01-11', status: 'active' },
                { id: 'u21', email: 'christopher.young@dealer.net', role: 'Car Dealer', joined: '2026-01-12', status: 'active' },
                { id: 'u22', email: 'betty.king@outlook.com', role: 'Realtor', joined: '2026-01-13', status: 'active' },
                { id: 'u23', email: 'daniel.wright@gmail.com', role: 'Other', joined: '2026-01-14', status: 'active' },
                { id: 'u24', email: 'margaret.lopez@realty.com', role: 'Realtor', joined: '2026-01-14', status: 'active' },
                { id: 'u25', email: 'paul.hill@autoparts.com', role: 'Mechanic', joined: '2026-01-15', status: 'active' },
                { id: 'u26', email: 'sandra.scott@email.com', role: 'Appliance Seller', joined: '2026-01-15', status: 'active' },
                { id: 'u27', email: 'mark.green@cars.net', role: 'Car Dealer', joined: '2026-01-16', status: 'active' },
                { id: 'u28', email: 'ashley.adams@homes.co', role: 'Realtor', joined: '2026-01-16', status: 'active' },
                { id: 'u29', email: 'steven.baker@gmail.com', role: 'Other', joined: '2026-01-17', status: 'active' },
                { id: 'u30', email: 'kimberly.nelson@realty.com', role: 'Realtor', joined: '2026-01-17', status: 'active' }
            ],
            premiumUsers: [
                { id: 'p1', email: 'john.smith@email.com', paidDate: '2025-12-01', lastRenewal: '2026-01-01', plan: 'Pro Monthly', amount: 9.99 },
                { id: 'p2', email: 'sarah.jones@realty.com', paidDate: '2025-12-15', lastRenewal: '2026-01-15', plan: 'Pro Monthly', amount: 9.99 },
                { id: 'p3', email: 'carlos.martinez@cars.net', paidDate: '2025-12-20', lastRenewal: '2026-01-17', plan: 'Pro Annual', amount: 99.99 },
                { id: 'p4', email: 'lisa.anderson@realty.com', paidDate: '2026-01-02', lastRenewal: '2026-01-02', plan: 'Pro Monthly', amount: 9.99 },
                { id: 'p5', email: 'joseph.lewis@autos.net', paidDate: '2026-01-10', lastRenewal: '2026-01-10', plan: 'Pro Monthly', amount: 9.99 },
                { id: 'p6', email: 'karen.allen@homes.com', paidDate: '2026-01-12', lastRenewal: '2026-01-12', plan: 'Pro Monthly', amount: 9.99 },
                { id: 'p7', email: 'christopher.young@dealer.net', paidDate: '2026-01-14', lastRenewal: '2026-01-14', plan: 'Pro Annual', amount: 99.99 },
                { id: 'p8', email: 'margaret.lopez@realty.com', paidDate: '2026-01-16', lastRenewal: '2026-01-16', plan: 'Pro Monthly', amount: 9.99 }
            ],
            payments: [
                { id: 'pay1', user: 'John Smith', email: 'john.smith@email.com', amount: 9.99, method: 'Stripe', date: '2026-01-17', status: 'completed' },
                { id: 'pay2', user: 'Sarah Jones', email: 'sarah.jones@realty.com', amount: 9.99, method: 'Stripe', date: '2026-01-15', status: 'completed' },
                { id: 'pay3', user: 'Carlos Martinez', email: 'carlos.martinez@cars.net', amount: 99.99, method: 'PayPal', date: '2026-01-14', status: 'completed' },
                { id: 'pay4', user: 'Lisa Anderson', email: 'lisa.anderson@realty.com', amount: 9.99, method: 'Stripe', date: '2026-01-12', status: 'completed' },
                { id: 'pay5', user: 'Joseph Lewis', email: 'joseph.lewis@autos.net', amount: 9.99, method: 'Stripe', date: '2026-01-10', status: 'pending' },
                { id: 'pay6', user: 'Karen Allen', email: 'karen.allen@homes.com', amount: 9.99, method: 'PayPal', date: '2026-01-08', status: 'completed' },
                { id: 'pay7', user: 'Christopher Young', email: 'christopher.young@dealer.net', amount: 99.99, method: 'Stripe', date: '2026-01-06', status: 'completed' },
                { id: 'pay8', user: 'Margaret Lopez', email: 'margaret.lopez@realty.com', amount: 9.99, method: 'Stripe', date: '2026-01-04', status: 'refunded' },
                { id: 'pay9', user: 'Emily Davis', email: 'emily.davis@outlook.com', amount: 9.99, method: 'PayPal', date: '2026-01-02', status: 'completed' },
                { id: 'pay10', user: 'Mike Brown', email: 'mike.brown@gmail.com', amount: 9.99, method: 'Stripe', date: '2025-12-28', status: 'completed' },
                { id: 'pay11', user: 'David Lee', email: 'david.lee@autofix.com', amount: 9.99, method: 'Stripe', date: '2025-12-25', status: 'completed' },
                { id: 'pay12', user: 'Amanda Taylor', email: 'amanda.taylor@email.com', amount: 9.99, method: 'PayPal', date: '2025-12-22', status: 'failed' },
                { id: 'pay13', user: 'Robert Johnson', email: 'robert.johnson@dealer.com', amount: 99.99, method: 'Stripe', date: '2025-12-20', status: 'completed' },
                { id: 'pay14', user: 'James Thomas', email: 'james.thomas@gmail.com', amount: 9.99, method: 'Stripe', date: '2025-12-18', status: 'completed' },
                { id: 'pay15', user: 'Maria Garcia', email: 'maria.garcia@hotmail.com', amount: 9.99, method: 'PayPal', date: '2025-12-15', status: 'completed' }
            ],
            reports: {
                activeUsers: 184,
                totalRevenue: 2347.85,
                topCategory: 'Cars',
                totalListings: 412,
                premiumConversion: 14.2,
                monthlyGrowth: 23,
                revenueByMonth: { Aug: 890, Sep: 1120, Oct: 1450, Nov: 1780, Dec: 2100, Jan: 2347 }
            }
        };

        let currentAdminTab = 'users';

        function checkAdminAccess() {
            const isAdminRoute = window.location.hash === '#admin' || 
                                 window.location.hash === '#/admin' ||
                                 window.location.pathname.includes('/admin');
            
            if (isAdminRoute) {
                if (localStorage.getItem('admin') !== 'true') {
                    alert('üîí Access denied. Admin login required.');
                    window.location.hash = '';
                    return false;
                }
                showAdminPanel();
                return true;
            }
            return false;
        }

        // ===== FLOATING CHAT SUPPORT =====
        function toggleChatPanel() {
            const panel = document.getElementById('chat-panel');
            panel.classList.toggle('active');
        }

        function sendChatMessage() {
            const name = document.getElementById('chat-name').value.trim();
            const message = document.getElementById('chat-message').value.trim();
            
            if (!name || !message) {
                alert('Please enter your name and message.');
                return;
            }
            
            const subject = encodeURIComponent('Support Request from Treazure Yaad');
            const body = encodeURIComponent(`Hi,\n\nName: ${name}\n\nMessage:\n${message}\n\n---\nSent from Treazure Yaad Support Chat`);
            
            window.location.href = `mailto:your@email.com?subject=${subject}&body=${body}`;
            
            // Clear and close
            document.getElementById('chat-name').value = '';
            document.getElementById('chat-message').value = '';
            toggleChatPanel();
        }

        // Hide chat button on admin panel
        function updateChatVisibility() {
            const chatBtn = document.getElementById('chat-float-btn');
            const chatPanel = document.getElementById('chat-panel');
            const isAdmin = window.location.hash === '#admin';
            
            if (chatBtn) chatBtn.style.display = isAdmin ? 'none' : 'flex';
            if (chatPanel && isAdmin) chatPanel.classList.remove('active');
        }

        // ===== SECRET ADMIN CREDENTIALS =====
        // Username: treazure_admin
        // Password: Y@@d2026!
        const ADMIN_USERNAME = 'treazure_admin';
        const ADMIN_PASSWORD = 'Y@@d2026!';
        
        // Secret key combo to open admin login: Press Ctrl+Shift+A
        let secretKeySequence = [];
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                openAdminLogin();
            }
        });
        
        function openAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('active');
            document.getElementById('admin-username').focus();
            document.getElementById('admin-login-error').textContent = '';
        }
        
        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.remove('active');
            document.getElementById('admin-username').value = '';
            document.getElementById('admin-password').value = '';
            document.getElementById('admin-login-error').textContent = '';
        }
        
        function handleAdminLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('admin-login-error');
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                localStorage.setItem('admin', 'true');
                closeAdminLogin();
                window.location.hash = '#admin';
                showAdminPanel();
            } else {
                errorEl.textContent = '‚ùå Invalid credentials. Access denied.';
                document.getElementById('admin-password').value = '';
            }
            
            return false;
        }
        
        function secretAdminLogin() {
            // Now requires proper login
            openAdminLogin();
        }

        function adminLogout() {
            localStorage.removeItem('admin');
            window.location.hash = '';
            hideAdminPanel();
        }

        function showAdminPanel() {
            // Hide all main page elements
            const navbar = document.querySelector('.navbar');
            const adBanner = document.querySelector('.ad-banner');
            const tickerBar = document.querySelector('.ticker-bar');
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const footer = document.getElementById('site-footer');
            const chatBtn = document.getElementById('chat-float-btn');
            const chatPanel = document.getElementById('chat-panel');
            
            if (navbar) navbar.style.display = 'none';
            if (adBanner) adBanner.style.display = 'none';
            if (tickerBar) tickerBar.style.display = 'none';
            if (sidebar) sidebar.style.display = 'none';
            if (mainContent) mainContent.style.display = 'none';
            if (footer) footer.style.display = 'none';
            if (chatBtn) chatBtn.style.display = 'none';
            if (chatPanel) chatPanel.classList.remove('active');
            
            // Show admin panel
            const adminPanel = document.getElementById('admin-panel');
            if (adminPanel) {
                adminPanel.classList.add('active');
                adminPanel.style.display = 'block';
            }
            
            // Render the admin data
            renderAdminColumns();
        }

        function hideAdminPanel() {
            // Stop the activity feed interval
            if (activityInterval) {
                clearInterval(activityInterval);
                activityInterval = null;
            }
            
            // Stop the health card interval
            if (healthInterval) {
                clearInterval(healthInterval);
                healthInterval = null;
            }
            
            // Stop the heatmap interval
            if (heatmapInterval) {
                clearInterval(heatmapInterval);
                heatmapInterval = null;
            }
            
            // Show all main page elements
            const navbar = document.querySelector('.navbar');
            const adBanner = document.querySelector('.ad-banner');
            const tickerBar = document.querySelector('.ticker-bar');
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');
            const footer = document.getElementById('site-footer');
            const chatBtn = document.getElementById('chat-float-btn');
            
            if (navbar) navbar.style.display = 'flex';
            if (adBanner) adBanner.style.display = 'flex';
            if (tickerBar) tickerBar.style.display = 'flex';
            if (sidebar) sidebar.style.display = 'block';
            if (mainContent) mainContent.style.display = 'block';
            if (footer) footer.style.display = 'flex';
            if (chatBtn) chatBtn.style.display = 'flex';
            
            // Hide admin panel
            const adminPanel = document.getElementById('admin-panel');
            if (adminPanel) {
                adminPanel.classList.remove('active');
                adminPanel.style.display = 'none';
            }
        }

        function renderAdminColumns() {
            renderUsersColumn();
            renderPremiumColumn();
            renderPaymentsColumn();
            updateAdminLog();
            initActivityFeed();
            initHealthCard();
            initWorldHeatmap();
        }

        // ===== LIVE ACTIVITY FEED =====
        const activityTemplates = [
            { type: 'signup', templates: [
                'New signup - alex@jam.com',
                'New signup - maria.santos@gmail.com',
                'New signup - kingston_dealer@yahoo.com',
                'New signup - beachhouse.mike@outlook.com',
                'New signup - carman2026@hotmail.com',
                'New signup - yacht.lover@icloud.com',
                'New signup - jm_realtor@realty.com',
                'New signup - fastcars_dave@gmail.com'
            ]},
            { type: 'listing', templates: [
                'Listing posted - 2018 Jeep Wrangler, $25k',
                'Listing posted - 3BR Beach House, $450k',
                'Listing posted - 2021 BMW X5, $52k',
                'Listing posted - Fishing Boat, $18k',
                'Listing posted - 5 Acres Land, $89k',
                'Listing posted - 2020 Tesla Model 3, $38k',
                'Listing posted - Yacht Slip Rental, $2,500/mo',
                'Listing posted - 2019 Harley Davidson, $22k'
            ]},
            { type: 'bid', templates: [
                'Bid placed - $8,200 on fishing boat',
                'Bid placed - $245,000 on lake house',
                'Bid placed - $42,500 on 2019 BMW',
                'Bid placed - $1.2M on luxury yacht',
                'Bid placed - $15,800 on jet ski',
                'Bid placed - $78,000 on beach property',
                'Bid placed - $32,000 on motorcycle'
            ]},
            { type: 'upgrade', templates: [
                'User upgraded to Pro - $9.99',
                'User upgraded to Pro - $9.99',
                'User renewed Pro - $9.99',
                'User upgraded to Pro - $9.99'
            ]},
            { type: 'view', templates: [
                'Hot listing! 500+ views - Tesla Model 3',
                '100 views today - Miami Beach House',
                'Trending - Kingston Property'
            ]},
            { type: 'chat', templates: [
                'New chat started - BMW M3 inquiry',
                'Chat message - "Is this still available?"',
                'Deal closed via chat - $45,000'
            ]}
        ];

        let activityFeed = [];
        let activityInterval = null;

        function getRandomActivity() {
            const category = activityTemplates[Math.floor(Math.random() * activityTemplates.length)];
            const template = category.templates[Math.floor(Math.random() * category.templates.length)];
            return {
                type: category.type,
                text: template,
                time: new Date(),
                isNew: true
            };
        }

        function formatActivityTime(date) {
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric' 
            }) + ', ' + date.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit',
                hour12: true 
            });
        }

        function renderActivityFeed() {
            const container = document.getElementById('admin-activity-list');
            if (!container) return;

            container.innerHTML = activityFeed.map((item, index) => `
                <div class="activity-item ${item.isNew ? 'new' : ''}">
                    <div class="activity-text">
                        <span class="activity-dot"></span>
                        ${item.text}
                    </div>
                    <div class="activity-time">${formatActivityTime(item.time)}</div>
                </div>
            `).join('');

            // Scroll to top to show newest
            container.scrollTop = 0;
        }

        function addNewActivity() {
            // Mark all existing as not new
            activityFeed.forEach(item => item.isNew = false);
            
            // Add new activity at the beginning
            const newActivity = getRandomActivity();
            activityFeed.unshift(newActivity);
            
            // Keep only latest 10
            if (activityFeed.length > 10) {
                activityFeed = activityFeed.slice(0, 10);
            }
            
            renderActivityFeed();
        }

        function initActivityFeed() {
            // Clear any existing interval
            if (activityInterval) {
                clearInterval(activityInterval);
            }
            
            // Initialize with 5 random activities
            activityFeed = [];
            for (let i = 0; i < 5; i++) {
                const activity = getRandomActivity();
                activity.isNew = false;
                activity.time = new Date(Date.now() - (i * 60000 * Math.random() * 10)); // Random past times
                activityFeed.push(activity);
            }
            
            renderActivityFeed();
            
            // Add new activity every 20 seconds
            activityInterval = setInterval(addNewActivity, 20000);
        }

        // ===== ADMIN TABS =====
        function switchAdminTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`admin-tab-${tabName}`).classList.add('active');
        }

        // ===== HEATMAP =====
        function switchHeatmapRegion(region) {
            // Update buttons
            document.querySelectorAll('.heatmap-switch-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide maps
            document.getElementById('heatmap-us').style.display = region === 'us' ? 'block' : 'none';
            document.getElementById('heatmap-caribbean').style.display = region === 'caribbean' ? 'block' : 'none';
            
            // Hide info
            document.getElementById('heatmap-info').classList.remove('active');
        }

        // ===== WORLD HEATMAP =====
        const heatmapLocations = {
            // US locations (60%)
            us: [
                { name: 'Minneapolis, MN', x: 420, y: 130, cluster: 8 },
                { name: 'Miami, FL', x: 560, y: 280, cluster: 7 },
                { name: 'Dallas, TX', x: 380, y: 240, cluster: 5 },
                { name: 'Houston, TX', x: 400, y: 260, cluster: 4 },
                { name: 'Los Angeles, CA', x: 180, y: 200, cluster: 5 },
                { name: 'San Francisco, CA', x: 160, y: 170, cluster: 3 },
                { name: 'Phoenix, AZ', x: 220, y: 220, cluster: 3 },
                { name: 'Denver, CO', x: 280, y: 180, cluster: 2 },
                { name: 'Chicago, IL', x: 460, y: 150, cluster: 4 },
                { name: 'New York, NY', x: 560, y: 150, cluster: 5 },
                { name: 'Atlanta, GA', x: 520, y: 230, cluster: 3 },
                { name: 'Seattle, WA', x: 170, y: 120, cluster: 2 }
            ],
            // Caribbean (30%)
            caribbean: [
                { name: 'Kingston, Jamaica', x: 480, y: 310, cluster: 6 },
                { name: 'Nassau, Bahamas', x: 530, y: 290, cluster: 4 },
                { name: 'Santo Domingo, DR', x: 520, y: 320, cluster: 3 },
                { name: 'Port-au-Prince, Haiti', x: 500, y: 315, cluster: 2 },
                { name: 'San Juan, PR', x: 550, y: 305, cluster: 2 },
                { name: 'Bridgetown, Barbados', x: 580, y: 340, cluster: 2 }
            ],
            // Elsewhere (10%)
            elsewhere: [
                { name: 'London, UK', x: 480, y: 110, cluster: 2 },
                { name: 'Toronto, Canada', x: 520, y: 130, cluster: 2 },
                { name: 'Vancouver, Canada', x: 170, y: 110, cluster: 1 }
            ]
        };

        const fakeEmails = [
            'jane.doe', 'mike.smith', 'sarah.j', 'carlos.m', 'lisa.wang',
            'john.b', 'emma.k', 'david.r', 'amy.chen', 'marcus.t',
            'nina.p', 'alex.g', 'taylor.s', 'jordan.l', 'casey.m',
            'robin.h', 'sam.wilson', 'pat.brown', 'chris.lee', 'morgan.j'
        ];

        const emailDomains = ['gmail.com', 'yahoo.com', 'outlook.com', 'icloud.com', 'hotmail.com', 'mail.com'];
        
        let heatmapDots = [];
        let heatmapInterval = null;

        function generateHeatmapDots() {
            heatmapDots = [];
            
            // Generate US dots (60% = 24 dots)
            heatmapLocations.us.forEach(loc => {
                for (let i = 0; i < loc.cluster; i++) {
                    heatmapDots.push({
                        location: loc.name,
                        x: loc.x + (Math.random() - 0.5) * 30,
                        y: loc.y + (Math.random() - 0.5) * 20,
                        isPro: Math.random() < 0.3,
                        size: 4 + Math.random() * 4
                    });
                }
            });
            
            // Generate Caribbean dots (30% = 12 dots)
            heatmapLocations.caribbean.forEach(loc => {
                for (let i = 0; i < loc.cluster; i++) {
                    heatmapDots.push({
                        location: loc.name,
                        x: loc.x + (Math.random() - 0.5) * 25,
                        y: loc.y + (Math.random() - 0.5) * 15,
                        isPro: Math.random() < 0.35,
                        size: 4 + Math.random() * 4
                    });
                }
            });
            
            // Generate elsewhere dots (10% = 4 dots)
            heatmapLocations.elsewhere.forEach(loc => {
                for (let i = 0; i < loc.cluster; i++) {
                    heatmapDots.push({
                        location: loc.name,
                        x: loc.x + (Math.random() - 0.5) * 20,
                        y: loc.y + (Math.random() - 0.5) * 15,
                        isPro: Math.random() < 0.25,
                        size: 4 + Math.random() * 3
                    });
                }
            });
        }

        function renderHeatmapDots() {
            const container = document.getElementById('heatmap-dots');
            if (!container) return;
            
            container.innerHTML = heatmapDots.map((dot, idx) => `
                <circle 
                    class="user-dot ${dot.isPro ? 'gold' : 'purple'}"
                    cx="${dot.x}"
                    cy="${dot.y}"
                    r="${dot.size}"
                    data-location="${dot.location}"
                    data-idx="${idx}"
                    onclick="showUserPopup('${dot.location}')"
                />
            `).join('');
        }

        function shiftDots() {
            heatmapDots.forEach(dot => {
                dot.x += (Math.random() - 0.5) * 3;
                dot.y += (Math.random() - 0.5) * 2;
            });
            renderHeatmapDots();
        }

        function generateFakeUsers(location, count) {
            const users = [];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            
            for (let i = 0; i < count; i++) {
                const email = fakeEmails[Math.floor(Math.random() * fakeEmails.length)] + 
                             Math.floor(Math.random() * 99) + '@' + 
                             emailDomains[Math.floor(Math.random() * emailDomains.length)];
                const month = months[Math.floor(Math.random() * 12)];
                const year = Math.random() < 0.7 ? '2025' : '2026';
                const listings = Math.floor(Math.random() * 8) + 1;
                const isPro = Math.random() < 0.3;
                
                users.push({ email, joined: `${month} ${year}`, listings, isPro });
            }
            return users;
        }

        function showUserPopup(location) {
            const popup = document.getElementById('heatmap-user-popup');
            const locationEl = document.getElementById('popup-location');
            const usersEl = document.getElementById('popup-users');
            
            locationEl.textContent = location;
            
            const userCount = 5 + Math.floor(Math.random() * 6); // 5-10 users
            const users = generateFakeUsers(location, userCount);
            
            usersEl.innerHTML = users.map(user => `
                <div class="popup-user ${user.isPro ? 'pro' : ''}">
                    <div class="popup-user-email">${user.email}</div>
                    <div class="popup-user-meta">
                        Joined: ${user.joined} ‚Ä¢ ${user.listings} listings ‚Ä¢ 
                        ${user.isPro ? '<span class="pro-badge">‚≠ê Pro</span>' : 'Free'}
                    </div>
                </div>
            `).join('');
            
            popup.classList.add('active');
        }

        function closeUserPopup() {
            document.getElementById('heatmap-user-popup').classList.remove('active');
        }

        function initWorldHeatmap() {
            generateHeatmapDots();
            renderHeatmapDots();
            
            // Clear existing interval
            if (heatmapInterval) {
                clearInterval(heatmapInterval);
            }
            
            // Shift dots every 20 seconds
            heatmapInterval = setInterval(shiftDots, 20000);
        }
        
        // Legacy function for compatibility
        function switchHeatmapRegion(region) {
            // No longer needed with world map
        }
        
        function showHeatmapInfo(dot) {
            // Legacy - now uses showUserPopup
        }

        // ===== HEALTH CARD =====
        let healthInterval = null;

        function updateHealthStats() {
            const uptimeEl = document.getElementById('health-uptime');
            const speedEl = document.getElementById('health-speed');
            const errorsEl = document.getElementById('health-errors');
            
            if (!uptimeEl || !speedEl || !errorsEl) return;
            
            // Random uptime between 99.1% and 99.9%
            const uptime = (99 + Math.random() * 0.9).toFixed(1);
            uptimeEl.textContent = uptime + '%';
            
            // Random speed between 150ms and 350ms
            const speed = Math.floor(150 + Math.random() * 200);
            speedEl.textContent = speed + 'ms';
            
            // Random errors - mostly 0-3, occasionally higher
            const errorRoll = Math.random();
            let errors;
            if (errorRoll < 0.7) {
                errors = Math.floor(Math.random() * 3); // 0-2
            } else if (errorRoll < 0.9) {
                errors = Math.floor(3 + Math.random() * 3); // 3-5
            } else {
                errors = Math.floor(6 + Math.random() * 5); // 6-10
            }
            
            errorsEl.textContent = errors;
            
            // Update error styling
            errorsEl.classList.remove('error', 'error-critical');
            if (errors > 5) {
                errorsEl.classList.add('error-critical');
            } else if (errors > 2) {
                errorsEl.classList.add('error');
            }
        }

        function initHealthCard() {
            if (healthInterval) {
                clearInterval(healthInterval);
            }
            
            updateHealthStats();
            healthInterval = setInterval(updateHealthStats, 30000);
        }

        function renderUsersColumn() {
            const container = document.getElementById('admin-users-list');
            const isPro = (email) => adminData.premiumUsers.some(p => p.email === email);
            
            container.innerHTML = adminData.users.slice(0, 20).map(user => `
                <div class="admin-row" id="user-row-${user.id}">
                    <div class="admin-row-info">
                        <div class="admin-row-email">${user.email}</div>
                        <div class="admin-row-meta">${user.role} ¬∑ ${user.joined}</div>
                    </div>
                    <span class="admin-row-badge ${isPro(user.email) ? 'pro' : 'free'}">${isPro(user.email) ? 'PRO' : 'Free'}</span>
                    <button class="admin-row-btn delete" onclick="adminDeleteUser('${user.id}', '${user.email}')">Delete</button>
                </div>
            `).join('');
        }

        function renderPremiumColumn() {
            const container = document.getElementById('admin-premium-list');
            
            container.innerHTML = adminData.premiumUsers.map(user => `
                <div class="admin-row" id="premium-row-${user.id}">
                    <div class="admin-row-info">
                        <div class="admin-row-email">${user.email}</div>
                        <div class="admin-row-meta">Paid ${user.paidDate} ¬∑ Renews ${user.lastRenewal}</div>
                    </div>
                    <button class="admin-row-btn expire" onclick="adminExpirePro('${user.id}', '${user.email}')">Expire Now</button>
                </div>
            `).join('');
        }

        function renderPaymentsColumn() {
            const container = document.getElementById('admin-payments-list');
            
            container.innerHTML = adminData.payments.slice(0, 10).map(pay => `
                <div class="admin-row" id="payment-row-${pay.id}">
                    <div class="admin-row-info">
                        <div class="admin-row-email">${pay.user} ‚Äî $${pay.amount}</div>
                        <div class="admin-row-meta">${pay.method} ¬∑ ${pay.date}</div>
                    </div>
                    ${pay.status === 'completed' ? 
                        `<button class="admin-row-btn refund" onclick="adminRefundPayment('${pay.id}', '${pay.user}')">Refund</button>` : 
                        `<span class="admin-row-badge ${pay.status}">${pay.status}</span>`
                    }
                </div>
            `).join('');
        }

        function updateAdminLog() {
            document.getElementById('admin-log').innerHTML = `Last action: <span class="admin-log-action">${lastAdminAction}</span>`;
        }

        function adminDeleteUser(userId, email) {
            const row = document.getElementById(`user-row-${userId}`);
            if (row) {
                row.style.opacity = '0';
                row.style.transform = 'translateX(-20px)';
                row.style.transition = 'all 0.3s ease';
                
                setTimeout(() => {
                    const index = adminData.users.findIndex(u => u.id === userId);
                    if (index > -1) {
                        adminData.users.splice(index, 1);
                    }
                    lastAdminAction = `Deleted user ${email}`;
                    renderAdminColumns();
                }, 300);
            }
        }

        function adminExpirePro(userId, email) {
            const row = document.getElementById(`premium-row-${userId}`);
            if (row) {
                row.style.opacity = '0';
                row.style.transform = 'translateX(-20px)';
                row.style.transition = 'all 0.3s ease';
                
                setTimeout(() => {
                    const index = adminData.premiumUsers.findIndex(u => u.id === userId);
                    if (index > -1) {
                        adminData.premiumUsers.splice(index, 1);
                    }
                    lastAdminAction = `Expired Pro for ${email}`;
                    renderAdminColumns();
                }, 300);
            }
        }

        function adminRefundPayment(payId, userName) {
            const payment = adminData.payments.find(p => p.id === payId);
            if (payment) {
                payment.status = 'refunded';
                lastAdminAction = `Refunded $${payment.amount} to ${userName}`;
                renderAdminColumns();
            }
        }

        function closeAdminModal() {
            document.getElementById('admin-modal').classList.remove('active');
        }

        // Check for admin access on page load
        window.addEventListener('hashchange', checkAdminAccess);
        if (window.location.hash === '#admin') {
            setTimeout(checkAdminAccess, 100);
        }

        // ===== LOADING SPINNER =====
        
        function showLoading(text = 'Loading...') {
            document.querySelector('.loading-text').textContent = text;
            document.getElementById('loading-overlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('active');
        }

        // Show loading on search
        const originalSearch = document.getElementById('search-input');
        let searchTimeout;
        if (originalSearch) {
            const originalHandler = originalSearch.oninput;
            originalSearch.oninput = function(e) {
                showLoading('Searching...');
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    if (originalHandler) originalHandler.call(this, e);
                    hideLoading();
                }, 300);
            };
        }

        // ===== 404 PAGE =====
        
        function show404() {
            document.querySelector('.app-container').style.display = 'none';
            document.getElementById('admin-panel').classList.remove('active');
            document.getElementById('page-404').classList.add('active');
        }

        function goHome() {
            document.getElementById('page-404').classList.remove('active');
            document.querySelector('.app-container').style.display = 'flex';
            window.location.hash = '';
        }

        // Check for invalid routes
        function checkRoute() {
            const validHashes = ['', '#admin', '#auctions', '#dashboard', '#compare', '#premium-pricing'];
            const currentHash = window.location.hash;
            if (currentHash && !validHashes.includes(currentHash) && !currentHash.startsWith('#category-')) {
                // For standalone HTML, we're lenient - only show 404 for clearly invalid routes
            }
        }

        // ===== MOBILE HAMBURGER MENU =====
        
        function toggleMobileMenu() {
            const btn = document.getElementById('hamburger-btn');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('mobile-drawer-overlay');
            
            btn.classList.toggle('active');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        function closeMobileMenu() {
            const btn = document.getElementById('hamburger-btn');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('mobile-drawer-overlay');
            
            btn.classList.remove('active');
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        }

        // Close mobile menu when clicking a category
        document.addEventListener('click', (e) => {
            if (e.target.closest('.nav-item')) {
                closeMobileMenu();
            }
        });

        // ===== CONTACT FORM WITH MAILTO =====
        
        let currentContactListing = null;

        function openContactForm(listing) {
            currentContactListing = listing;
            document.getElementById('contact-listing-title').textContent = `About: ${listing.title}`;
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-email').value = '';
            document.getElementById('contact-message').value = `Hi, I'm interested in your listing "${listing.title}" for ${listing.price}. Is it still available?`;
            document.getElementById('contact-form-modal').classList.add('active');
        }

        function closeContactForm() {
            document.getElementById('contact-form-modal').classList.remove('active');
            currentContactListing = null;
        }

        function sendContactEmail() {
            const name = document.getElementById('contact-name').value;
            const email = document.getElementById('contact-email').value;
            const message = document.getElementById('contact-message').value;
            
            if (!name || !email || !message) {
                alert('Please fill in all fields');
                return;
            }

            const listingTitle = currentContactListing ? currentContactListing.title : 'Unknown Listing';
            const listingPrice = currentContactListing ? currentContactListing.price : '';
            
            const subject = encodeURIComponent(`New Listing Inquiry From Treazure Yaad - ${listingTitle}`);
            const body = encodeURIComponent(
`New inquiry from Treazure Yaad:

Listing: ${listingTitle}
Price: ${listingPrice}

From: ${name}
Email: ${email}

Message:
${message}

---
Sent via Treazure Yaad Contact Form`
            );
            
            // Open mailto link
            window.location.href = `mailto:youremail@gmail.com?subject=${subject}&body=${body}`;
            
            showLoading('Opening email client...');
            setTimeout(() => {
                hideLoading();
                closeContactForm();
                alert('üìß Email client opened! Send your message to contact the seller.');
            }, 500);
        }

        // Update chat button to use contact form
        function handleContactClick(listingJson) {
            try {
                const listing = JSON.parse(listingJson.replace(/&quot;/g, '"'));
                openContactForm(listing);
            } catch (e) {
                console.error('Error parsing listing:', e);
            }
        }

        // ===== LEGAL TERMS & PRIVACY =====
        
        const legalContent = {
            terms: `
                <h3>Terms of Service & Caribbean User Agreement</h3>
                <p>By using Treazure Yaad, you acknowledge and agree to the following terms:</p>
                
                <h3>Service Area</h3>
                <p>We serve users in the United States, Canada, and the Caribbean. By using this platform, you confirm that you are located in or conducting business within these regions.</p>
                
                <h3>Age & Listing Certification</h3>
                <p>You certify that your listings are real, legal in your local jurisdiction, and that you are at least eighteen (18) years old ‚Äî even if that means sixteen in some islands. You represent that all items, properties, and services you list comply with applicable local, state, and federal laws in your jurisdiction.</p>
                
                <h3>Data Storage</h3>
                <p>All user data is stored on secure servers located in the United States of America. By using our service, you consent to the transfer, processing, and storage of your data on US servers, regardless of your country of residence.</p>
                
                <h3>Dispute Resolution</h3>
                <p>Local laws apply to all transactions. However, any disputes arising from the use of this platform shall be resolved through binding arbitration only, conducted in the State of Florida, USA. You waive your right to participate in class action lawsuits or jury trials. No disputes shall be resolved in court.</p>
                
                <h3>Account Termination</h3>
                <p>You can be banned for fake listings, fraudulent activity, or violation of these terms. Bans are final with no appeal process. We reserve the right to terminate accounts at our sole discretion without prior notice or explanation.</p>
                
                <h3>Refunds ‚Äî Caribbean Transactions</h3>
                <p>We do not issue refunds on Caribbean transactions unless fraud is proven within seven (7) days of the transaction date. Proof of fraud must be submitted with supporting documentation. All other refund requests for Caribbean transactions will be denied.</p>
                
                <h3>Pro Subscription Refunds</h3>
                <p>For US and Canadian users, Pro subscriptions may be refunded within seven (7) days of initial purchase. After this period, no refunds will be issued.</p>
                
                <h3>Limitation of Liability</h3>
                <p>Treazure Yaad is not responsible for transactions between users. We provide the platform; all dealings are between buyers and sellers. Use caution and common sense.</p>
            `,
            privacy: `
                <h3>Privacy Policy</h3>
                <p>Your privacy matters to us. Here's what you need to know:</p>
                
                <h3>Information Collection</h3>
                <p>We collect your name, email, and listing data when you sign up. Payment information is processed securely through third-party providers and is not stored on our servers.</p>
                
                <h3>Data Storage Location</h3>
                <p>All user data is stored on secure servers located in the United States of America. By using our service, you consent to this data transfer and storage.</p>
                
                <h3>Cookies & Tracking</h3>
                <p>We use cookies to:</p>
                <ul>
                    <li>Keep you logged in</li>
                    <li>Remember your preferences</li>
                    <li>Analyze how you use the site</li>
                    <li>Serve relevant advertisements</li>
                </ul>
                
                <h3>Data Sharing</h3>
                <p>We do not sell your personal information. We may share data with service providers who help us operate the platform, or when required by law.</p>
                
                <h3>Your Rights</h3>
                <p>You can request access to, correction of, or deletion of your data at any time by contacting us. Account deletion will remove your data within 30 days.</p>
                
                <h3>Updates</h3>
                <p>We may update this policy. Continued use of the service after changes constitutes acceptance of the new terms.</p>
            `
        };

        function openLegalModal(type) {
            const modal = document.getElementById('legal-modal');
            const title = document.getElementById('legal-modal-title');
            const body = document.getElementById('legal-modal-body');
            
            title.textContent = type === 'terms' ? 'Terms of Service' : 'Privacy Policy';
            body.innerHTML = legalContent[type];
            modal.classList.add('active');
        }

        function closeLegalModal() {
            document.getElementById('legal-modal').classList.remove('active');
        }

        function acceptLegalTerms() {
            document.getElementById('signup-terms').checked = true;
            document.getElementById('terms-error').classList.remove('visible');
            closeLegalModal();
        }

        function openLegalPage(type) {
            document.querySelector('.app-container').style.display = 'none';
            document.getElementById('admin-panel').classList.remove('active');
            document.getElementById('site-footer').style.display = 'none';
            
            if (type === 'terms') {
                document.getElementById('terms-page').classList.add('active');
            } else {
                document.getElementById('privacy-page').classList.add('active');
            }
        }

        function closeLegalPage() {
            document.getElementById('terms-page').classList.remove('active');
            document.getElementById('privacy-page').classList.remove('active');
            document.querySelector('.app-container').style.display = 'flex';
            document.getElementById('site-footer').style.display = 'flex';
        }

        // ===== ONLINE STATUS SYSTEM =====
        
        let userOnlineStatus = localStorage.getItem('userOnlineStatus') || 'online';
        
        function updateOnlineStatus(status) {
            userOnlineStatus = status;
            localStorage.setItem('userOnlineStatus', status);
            
            // Update navbar indicator
            const dot = document.getElementById('navbar-online-dot');
            const text = document.getElementById('navbar-online-text');
            
            if (dot && text) {
                dot.className = `online-dot ${status}`;
                text.className = `online-text ${status}`;
                text.textContent = status === 'online' ? 'Online' : 'Offline';
            }
            
            // Update all seller status dots on cards
            document.querySelectorAll('.seller-online-dot').forEach(el => {
                el.className = `online-dot seller-online-dot ${status}`;
            });
            document.querySelectorAll('.seller-online-text').forEach(el => {
                el.className = `online-text seller-online-text ${status}`;
                el.textContent = status === 'online' ? 'Online' : 'Offline';
            });
        }

        function randomizeOnlineStatus() {
            if (isPremiumUser) {
                const newStatus = Math.random() > 0.3 ? 'online' : 'offline';
                updateOnlineStatus(newStatus);
            }
        }

        // Randomize status every 15 seconds for Pro users
        setInterval(() => {
            if (isPremiumUser) {
                randomizeOnlineStatus();
            }
        }, 15000);

        // Set online when opening chat
        const originalOpenContactForm = openContactForm;
        openContactForm = function(listing) {
            if (isPremiumUser) {
                updateOnlineStatus('online');
            }
            originalOpenContactForm(listing);
        };

        // Set offline on page close
        window.addEventListener('beforeunload', () => {
            if (isPremiumUser) {
                localStorage.setItem('userOnlineStatus', 'offline');
            }
        });

        // Initialize online status on page load
        function initOnlineStatus() {
            if (isPremiumUser) {
                updateOnlineStatus('online');
            }
        }

        // ===== TICKER BAR =====
        
        const tickerData = [
            { type: 'sale', item: '2019 Tesla Model 3', price: '$38,000', location: 'Miami, FL' },
            { type: 'sale', item: 'Jamaica Beach House', price: '$220,000', location: 'Montego Bay' },
            { type: 'auction', item: 'Fishing Boat Auction', timeLeft: '00:09:23' },
            { type: 'sale', item: '2021 BMW X5', price: '$52,000', location: 'Atlanta, GA' },
            { type: 'sale', item: 'Barbados Villa', price: '$450,000', location: 'St. James' },
            { type: 'auction', item: '3-Bed Lake House', timeLeft: '02:15:47' },
            { type: 'sale', item: 'Yacht 42ft Cruiser', price: '$185,000', location: 'Nassau, Bahamas' },
            { type: 'sale', item: '2020 Mercedes C300', price: '$41,500', location: 'Houston, TX' }
        ];

        function initTicker() {
            const tickerContent = document.getElementById('ticker-content');
            if (!tickerContent) return;

            let tickerHTML = '';
            
            // Generate ticker items
            tickerData.forEach(item => {
                if (item.type === 'sale') {
                    tickerHTML += `<span class="ticker-item">${item.item} sold for <span class="ticker-highlight">${item.price}</span> in ${item.location}</span>`;
                } else if (item.type === 'auction') {
                    tickerHTML += `<span class="ticker-item">${item.item} ends in <span class="ticker-urgent">${item.timeLeft}</span></span>`;
                }
            });

            // Duplicate for seamless loop
            tickerContent.innerHTML = tickerHTML + tickerHTML;
        }

        // Update auction timers in ticker
        function updateTickerTimers() {
            const tickerItems = document.querySelectorAll('.ticker-urgent');
            tickerItems.forEach(item => {
                const timeParts = item.textContent.split(':');
                if (timeParts.length === 3) {
                    let hours = parseInt(timeParts[0]);
                    let minutes = parseInt(timeParts[1]);
                    let seconds = parseInt(timeParts[2]);
                    
                    seconds--;
                    if (seconds < 0) {
                        seconds = 59;
                        minutes--;
                    }
                    if (minutes < 0) {
                        minutes = 59;
                        hours--;
                    }
                    if (hours < 0) {
                        hours = 0;
                        minutes = 0;
                        seconds = 0;
                    }
                    
                    item.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            });
        }

        // Update ticker timers every second
        setInterval(updateTickerTimers, 1000);

        // ===== HERO BACKGROUND =====
        
        function initHeroBackground() {
            const heroBackground = document.getElementById('hero-background');
            
            if (heroBackground) {
                // Use custom background image from public folder
                heroBackground.style.backgroundImage = `url('public/background.jpg')`;
            }
        }

        // Update Pro badge on page load
        function updateProBadge() {
            const badge = document.getElementById('pro-badge-nav');
            const icon = document.getElementById('pro-icon');
            const text = document.getElementById('pro-text');
            
            if (isPremiumUser) {
                badge.classList.add('unlocked');
                icon.textContent = 'üëë';
                text.textContent = 'Pro Member';
            } else {
                badge.classList.remove('unlocked');
                icon.textContent = 'üîí';
                text.textContent = 'Pro';
            }
        }
        
        // Upgrade to Pro
        function upgradeToPro() {
            // Fake payment success
            alert('üéâ Thanks! You\'re now Pro!\n\nYou now have unlimited chat access and all premium features.');
            
            // Store in localStorage
            localStorage.setItem('isPremiumUser', 'true');
            isPremiumUser = true;
            
            // Update UI
            updateProBadge();
            closeModal('pricing');
            
            // Re-render listings to update chat buttons
            renderListings();
        }
        
        function selectBasic() {
            alert('You\'re already on the Basic plan. Upgrade to Pro for unlimited chat!');
        }
        
        // Handle chat button click
        function handleChatClick(listingTitle, sellerIsPremium) {
            if (!isPremiumUser && !sellerIsPremium) {
                openModal('pricing');
            } else {
                alert(`Starting chat about: ${listingTitle}\n\n[Chat feature would open here]`);
            }
        }

        // Toggle sidebar collapse
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            sidebar.classList.toggle('collapsed');
            
            if (mainContent) {
                mainContent.classList.toggle('sidebar-collapsed');
            }
            
            // Save state to localStorage
            const isCollapsed = sidebar.classList.contains('collapsed');
            localStorage.setItem('sidebarCollapsed', isCollapsed);
        }

        // Restore sidebar state on load
        function restoreSidebarState() {
            const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            if (isCollapsed) {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.querySelector('.main-content');
                if (sidebar) sidebar.classList.add('collapsed');
                if (mainContent) mainContent.classList.add('sidebar-collapsed');
            }
        }

        // Build sidebar navigation
        function buildSidebar() {
            const vehiclesNav = document.getElementById('vehicles-nav');
            const partsNav = document.getElementById('parts-nav');
            const otherNav = document.getElementById('other-nav');

            Object.entries(categories).forEach(([key, cat]) => {
                const nav = cat.type === 'vehicle' ? vehiclesNav : cat.type === 'part' ? partsNav : otherNav;
                const count = listings[key] ? listings[key].length : 0;
                
                const button = document.createElement('button');
                button.className = 'nav-item' + (key === activeCategory ? ' active' : '');
                button.dataset.category = key;
                button.style.borderLeft = `4px solid ${cat.color}`;
                button.onclick = () => selectCategory(key);
                
                if (key === activeCategory) {
                    button.style.background = `linear-gradient(135deg, ${cat.colorDark} 0%, ${cat.color}40 100%)`;
                }
                
                button.innerHTML = `
                    <span class="nav-icon">${cat.icon}</span>
                    <span class="nav-text">${cat.name}</span>
                    <span class="nav-count" style="background: ${cat.color}">${count}</span>
                `;
                
                nav.appendChild(button);
            });
        }

        // Select category
        function selectCategory(category) {
            activeCategory = category;
            const cat = categories[category];
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                item.style.background = '';
                if (item.dataset.category === category) {
                    item.classList.add('active');
                    item.style.background = `linear-gradient(135deg, ${cat.colorDark} 0%, ${cat.color}40 100%)`;
                }
            });

            // Update title and subtitle
            const count = listings[category] ? listings[category].length : 0;
            document.getElementById('listings-title').textContent = cat.name;
            document.getElementById('listings-subtitle').textContent = `${count} listings available`;

            // Render listings
            renderListings();
            
            // Scroll to listings
            document.getElementById('featured').scrollIntoView({ behavior: 'smooth' });
        }

        // Parse price string to number
        function parsePrice(priceStr) {
            return parseInt(priceStr.replace(/[$,]/g, '')) || 0;
        }

        // Search handler
        let searchDebounceTimer;
        function handleSearch(query) {
            searchQuery = query;
            
            // Toggle clear button visibility
            const clearBtn = document.getElementById('search-clear');
            if (query.length > 0) {
                clearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
            }
            
            // Show loading spinner with debounce
            showLoading('üîç Searching...');
            clearTimeout(searchDebounceTimer);
            searchDebounceTimer = setTimeout(() => {
                renderListings();
                hideLoading();
            }, 200);
        }

        // Clear search
        function clearSearch() {
            searchQuery = '';
            document.getElementById('search-input').value = '';
            document.getElementById('search-clear').classList.remove('visible');
            renderListings();
        }

        // Filter listings based on search query
        function filterListings(listingsArray) {
            if (!searchQuery.trim()) return listingsArray;
            
            const query = searchQuery.toLowerCase().trim();
            
            // Check for price filters like "under 100k" or "below 50000"
            const underMatch = query.match(/(?:under|below|less than|<)\s*(\d+)\s*(k|thousand)?/i);
            const overMatch = query.match(/(?:over|above|more than|>)\s*(\d+)\s*(k|thousand)?/i);
            
            let maxPrice = null;
            let minPrice = null;
            let textQuery = query;
            
            if (underMatch) {
                let priceValue = parseInt(underMatch[1]);
                if (underMatch[2] && underMatch[2].toLowerCase() === 'k') {
                    priceValue *= 1000;
                } else if (priceValue < 1000) {
                    priceValue *= 1000; // Assume "under 500" means "under 500k"
                }
                maxPrice = priceValue;
                textQuery = query.replace(underMatch[0], '').trim();
            }
            
            if (overMatch) {
                let priceValue = parseInt(overMatch[1]);
                if (overMatch[2] && overMatch[2].toLowerCase() === 'k') {
                    priceValue *= 1000;
                } else if (priceValue < 1000) {
                    priceValue *= 1000;
                }
                minPrice = priceValue;
                textQuery = textQuery.replace(overMatch[0], '').trim();
            }
            
            return listingsArray.filter(listing => {
                const price = parsePrice(listing.price);
                const titleMatch = listing.title.toLowerCase().includes(textQuery);
                const locationMatch = listing.location.toLowerCase().includes(textQuery);
                // Also match category name if available
                const categoryMatch = listing.categoryData ? 
                    listing.categoryData.name.toLowerCase().includes(textQuery) : false;
                const textMatch = !textQuery || titleMatch || locationMatch || categoryMatch;
                
                const priceMatch = (!maxPrice || price <= maxPrice) && (!minPrice || price >= minPrice);
                
                return textMatch && priceMatch;
            });
        }

        // Get all listings from all categories with category info
        function getAllListings() {
            const allListings = [];
            Object.entries(listings).forEach(([categoryKey, categoryListings]) => {
                categoryListings.forEach(listing => {
                    allListings.push({
                        ...listing,
                        categoryKey: categoryKey,
                        categoryData: categories[categoryKey]
                    });
                });
            });
            return allListings;
        }

        // Render listings
        function renderListings() {
            const grid = document.getElementById('listings-grid');
            const titleEl = document.getElementById('listings-title');
            const subtitle = document.getElementById('listings-subtitle');
            
            // Special handling for compare view
            if (activeCategory === 'compare') {
                titleEl.textContent = '‚öñÔ∏è Compare';
                subtitle.textContent = `Comparing ${compareItems.length} items`;
                renderCompareView();
                return;
            }
            
            // Special handling for dashboard
            if (activeCategory === 'dashboard') {
                titleEl.textContent = 'üìä Dashboard';
                subtitle.textContent = 'Manage your listings and view analytics';
                renderDashboard();
                return;
            }
            
            // Special handling for auctions
            if (activeCategory === 'auctions' && !searchQuery.trim()) {
                titleEl.textContent = 'üî¥ Live Auctions';
                subtitle.textContent = '3 active auctions - Bid now!';
                renderAuctions();
                return;
            }
            
            // Clear auction intervals when leaving auctions
            if (auctionInterval) { clearInterval(auctionInterval); auctionInterval = null; }
            if (bidInterval) { clearInterval(bidInterval); bidInterval = null; }
            
            let currentListings;
            let isGlobalSearch = searchQuery.trim().length > 0;
            
            if (isGlobalSearch) {
                // Search across ALL categories
                const allListings = getAllListings();
                currentListings = filterListings(allListings);
                titleEl.textContent = 'Search Results';
                subtitle.textContent = `${currentListings.length} result${currentListings.length !== 1 ? 's' : ''} across all categories`;
            } else {
                // Show current category only
                const categoryListings = (listings[activeCategory] || []).map(listing => ({
                    ...listing,
                    categoryKey: activeCategory,
                    categoryData: categories[activeCategory]
                }));
                currentListings = categoryListings;
                titleEl.textContent = categories[activeCategory].name;
                subtitle.textContent = `${currentListings.length} listings available`;
            }

            // Show no results message
            if (currentListings.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üîç</div>
                        <p class="no-results-text">No results found</p>
                        <p class="no-results-hint">Try something else or <a href="#" onclick="clearSearch(); return false;" style="color: var(--purple);">clear your search</a></p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = currentListings.map(listing => {
                const price = parsePrice(listing.price);
                const isFeatured = price > 15000;
                const cat = listing.categoryData;
                
                // Generate seller badge HTML if role exists
                let sellerBadgeHTML = '';
                if (listing.sellerRole && roleLabels[listing.sellerRole]) {
                    const role = roleLabels[listing.sellerRole];
                    sellerBadgeHTML = `<span class="seller-badge ${role.class}"><span class="badge-icon">${role.icon}</span>${role.label}</span>`;
                }
                
                // Generate seller online status for Pro sellers only
                let sellerStatusHTML = '';
                const sellerIsPro = listing.premium === true;
                if (sellerIsPro) {
                    const status = userOnlineStatus;
                    sellerStatusHTML = `<div class="seller-status"><span class="online-dot seller-online-dot ${status}"></span><span class="online-text seller-online-text ${status}">${status === 'online' ? 'Online' : 'Offline'}</span></div>`;
                }
                
                // Generate rental badge HTML if listing is for rent
                let rentalBadgeHTML = '';
                if (listing.listingType === 'rent' && listing.rentalSubType && rentalSubTypeLabels[listing.rentalSubType]) {
                    const rentalInfo = rentalSubTypeLabels[listing.rentalSubType];
                    const badgeClass = rentalInfo.type === 'lease' ? 'rental-badge leasing' : 'rental-badge';
                    rentalBadgeHTML = `<span class="${badgeClass}">üîë ${rentalInfo.label}</span>`;
                }
                
                // Generate chat button based on premium status
                const sellerIsPremium = listing.premium === true;
                const listingDataStr = JSON.stringify(listing).replace(/"/g, '&quot;');
                let chatButtonHTML = '';
                if (isPremiumUser || sellerIsPremium) {
                    chatButtonHTML = `<button class="card-contact-btn" onclick="event.stopPropagation(); handleContactClick('${listingDataStr}')">üìß Contact Seller</button>`;
                } else {
                    chatButtonHTML = `<button class="card-contact-btn locked" onclick="event.stopPropagation(); openModal('pricing')"><span class="lock-icon">üîí</span> Unlock Chat - Upgrade to Pro</button>`;
                }
                
                // Generate Area Legends button for land listings only
                const isLandListing = listing.categoryKey === 'land' || activeCategory === 'land';
                let legendsButtonHTML = '';
                if (isLandListing && listing.location) {
                    legendsButtonHTML = `<button class="area-legends-btn" onclick="showAreaLegend('${listing.location.replace(/'/g, "\\'")}')"><span class="book-icon">üìñ</span> See Area Legends</button>`;
                }
                
                // Generate compare checkbox
                const inCompare = isItemInCompare(listing.id);
                const compareCheckboxHTML = `<div class="card-compare-checkbox ${inCompare ? 'selected' : ''}" onclick="event.stopPropagation(); toggleCompareItem(${JSON.stringify(listing).replace(/"/g, '&quot;')})"></div>`;
                const compareSelectedClass = inCompare ? 'compare-selected' : '';
                
                // Generate 360¬∞ Tour button (only for cars, trucks, properties, land, boats, yachts - not appliances/parts)
                const tourCategories = ['cars', 'trucks', 'properties', 'land', 'boats', 'yachts', 'motorcycles'];
                const listingCategory = listing.categoryKey || activeCategory;
                const showTourButton = tourCategories.includes(listingCategory);
                const listingIsPremium = listing.premium === true;
                let tourButtonHTML = '';
                if (showTourButton) {
                    if (isPremiumUser || listingIsPremium) {
                        tourButtonHTML = `<button class="tour-btn" onclick="event.stopPropagation(); openTour('${listing.title.replace(/'/g, "\\'")}', '${listingCategory}', ${listingIsPremium})">üîÑ 360¬∞ Tour</button>`;
                    } else {
                        tourButtonHTML = `<button class="tour-btn locked" onclick="event.stopPropagation(); openTour('${listing.title.replace(/'/g, "\\'")}', '${listingCategory}', ${listingIsPremium})">üîí 360¬∞ Tour - Upgrade</button>`;
                    }
                }
                
                if (isFeatured) {
                    return `
                        <div class="card premium ${compareSelectedClass}" style="animation: fadeInUp 0.4s ease forwards;">
                            <div class="card-inner">
                                <div class="card-image-container">
                                    ${compareCheckboxHTML}
                                    <img src="${listing.image}" alt="${listing.title}" class="card-image" />
                                    <div class="card-category-badge" style="border-color: ${cat.color}">${cat.icon}</div>
                                    <div class="featured-badge">Featured</div>
                                </div>
                                <div class="card-content">
                                    <div class="card-title-row">
                                        <h3 class="card-title">${listing.title}</h3>
                                        ${sellerBadgeHTML}
                                    </div>
                                    ${sellerStatusHTML}
                                    ${rentalBadgeHTML ? `<div style="margin-bottom: 0.5rem;">${rentalBadgeHTML}</div>` : ''}
                                    <div class="card-price-container">
                                        <span class="card-price">${listing.price}</span>
                                        <span class="premium-crown">üëë</span>
                                    </div>
                                    <div class="card-location">üìç ${listing.location}</div>
                                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                        ${legendsButtonHTML}
                                        ${tourButtonHTML}
                                    </div>
                                    ${isGlobalSearch ? `<div class="card-category-label" style="color: ${cat.color}; font-size: 0.85rem; margin-bottom: 0.5rem;">${cat.icon} ${cat.name}</div>` : ''}
                                    ${chatButtonHTML}
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="card ${compareSelectedClass}" style="animation: fadeInUp 0.4s ease forwards;">
                            <div class="card-image-container">
                                ${compareCheckboxHTML}
                                <img src="${listing.image}" alt="${listing.title}" class="card-image" />
                                <div class="card-category-badge" style="border-color: ${cat.color}">${cat.icon}</div>
                            </div>
                            <div class="card-content">
                                <div class="card-title-row">
                                    <h3 class="card-title">${listing.title}</h3>
                                    ${sellerBadgeHTML}
                                </div>
                                ${sellerStatusHTML}
                                ${rentalBadgeHTML ? `<div style="margin-bottom: 0.5rem;">${rentalBadgeHTML}</div>` : ''}
                                <div class="card-price">${listing.price}</div>
                                <div class="card-location">üìç ${listing.location}</div>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                    ${legendsButtonHTML}
                                    ${tourButtonHTML}
                                </div>
                                ${isGlobalSearch ? `<div class="card-category-label" style="color: ${cat.color}; font-size: 0.85rem; margin-bottom: 0.5rem;">${cat.icon} ${cat.name}</div>` : ''}
                                ${chatButtonHTML}
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Modal functions
        function openModal(type) {
            document.getElementById(type + 'Modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(type) {
            document.getElementById(type + 'Modal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function switchModal(type) {
            closeModal(type === 'signup' ? 'login' : 'signup');
            setTimeout(() => openModal(type), 200);
        }

        // Role display names and icons
        const roleLabels = {
            'realtor': { label: 'Verified Realtor', icon: 'üè†', class: 'realtor' },
            'car-dealer': { label: 'Certified Dealer', icon: 'üöó', class: 'car-dealer' },
            'mechanic': { label: 'Certified Mechanic', icon: 'üîß', class: 'mechanic' },
            'appliance-seller': { label: 'Verified Seller', icon: 'üì∫', class: 'appliance-seller' },
            'other': { label: 'Verified Seller', icon: '‚úì', class: 'other' }
        };

        function handleSignup(e) {
            e.preventDefault();
            
            // Gather form data
            const formData = {
                name: document.getElementById('signup-name').value,
                email: document.getElementById('signup-email').value,
                password: document.getElementById('signup-password').value,
                role: document.getElementById('signup-role').value
            };
            
            // Validate role is selected
            if (!formData.role) {
                alert('Please select what you sell.');
                return;
            }
            
            // Validate terms checkbox
            const termsCheckbox = document.getElementById('signup-terms');
            const termsError = document.getElementById('terms-error');
            if (!termsCheckbox.checked) {
                termsError.classList.add('visible');
                termsCheckbox.focus();
                return;
            }
            termsError.classList.remove('visible');
            
            // Simulate API call
            console.log('Sending to /api/signup:', formData);
            
            // Fake API response
            const roleInfo = roleLabels[formData.role];
            alert(`Account created successfully!\n\nWelcome, ${formData.name}!\n\nYour seller badge: ${roleInfo.icon} ${roleInfo.label}\n\nThis badge will appear on all your listings.`);
            
            closeModal('signup');
            
            // Reset form
            document.getElementById('signupForm').reset();
        }

        function handleLogin(e) {
            e.preventDefault();
            isLoggedIn = true;
            currentUser = 'John';
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', currentUser);
            updateLoginUI();
            closeModal('login');
            alert(`Login successful! Welcome back, ${currentUser}!`);
        }

        // Listing type selection
        let selectedListingType = 'buy';

        function selectListingType(type) {
            selectedListingType = type;
            
            // Update radio visual state
            document.getElementById('radio-buy').classList.toggle('selected', type === 'buy');
            document.getElementById('radio-rent').classList.toggle('selected', type === 'rent');
            
            // Show/hide rental subtype dropdown
            const subtypeContainer = document.getElementById('rental-subtype-container');
            if (type === 'rent') {
                subtypeContainer.style.display = 'block';
                document.getElementById('rental-subtype').required = true;
            } else {
                subtypeContainer.style.display = 'none';
                document.getElementById('rental-subtype').required = false;
            }
        }

        // Rental subtype labels
        const rentalSubTypeLabels = {
            'rent-cars': { label: 'For Rent', type: 'rent' },
            'lease-land': { label: 'Leasing', type: 'lease' },
            'lease-property': { label: 'Leasing', type: 'lease' },
            'lease-boats': { label: 'Leasing', type: 'lease' },
            'short-term': { label: 'For Rent', type: 'rent' }
        };

        function handlePostListing(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('listing-title').value,
                price: document.getElementById('listing-price').value,
                location: document.getElementById('listing-location').value,
                category: document.getElementById('listing-category').value,
                listingType: selectedListingType,
                rentalSubType: selectedListingType === 'rent' ? document.getElementById('rental-subtype').value : null
            };
            
            // Validate rental subtype if rent is selected
            if (formData.listingType === 'rent' && !formData.rentalSubType) {
                alert('Please select a rental type.');
                return;
            }
            
            console.log('Posting listing:', formData);
            
            // Show success message
            let message = `Listing created successfully!\n\nTitle: ${formData.title}\nPrice: ${formData.price}\nCategory: ${formData.category}`;
            if (formData.listingType === 'rent') {
                const subTypeInfo = rentalSubTypeLabels[formData.rentalSubType];
                message += `\n\nBadge: ${subTypeInfo.label}`;
            }
            
            alert(message);
            closeModal('postListing');
            document.getElementById('postListingForm').reset();
            selectListingType('buy'); // Reset to default
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Close modal on background click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });
        });

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                });
            }
        });

        // ===== LOCATION PICKER DATA =====
        
        // US States with fake counties
        const usStates = {
            'Alabama': ['Jefferson County', 'Mobile County', 'Madison County', 'Montgomery County', 'Shelby County'],
            'Alaska': ['Anchorage Borough', 'Fairbanks North Star', 'Matanuska-Susitna', 'Kenai Peninsula', 'Juneau City'],
            'Arizona': ['Maricopa County', 'Pima County', 'Pinal County', 'Yavapai County', 'Mohave County'],
            'Arkansas': ['Pulaski County', 'Benton County', 'Washington County', 'Sebastian County', 'Faulkner County'],
            'California': ['Los Angeles County', 'San Diego County', 'Orange County', 'Riverside County', 'San Bernardino County', 'Santa Clara County', 'Alameda County'],
            'Colorado': ['Denver County', 'El Paso County', 'Arapahoe County', 'Jefferson County', 'Adams County'],
            'Connecticut': ['Fairfield County', 'Hartford County', 'New Haven County', 'Litchfield County', 'Middlesex County'],
            'Delaware': ['New Castle County', 'Sussex County', 'Kent County'],
            'Florida': ['Miami-Dade County', 'Broward County', 'Palm Beach County', 'Hillsborough County', 'Orange County', 'Pinellas County'],
            'Georgia': ['Fulton County', 'Gwinnett County', 'Cobb County', 'DeKalb County', 'Chatham County'],
            'Hawaii': ['Honolulu County', 'Hawaii County', 'Maui County', 'Kauai County'],
            'Idaho': ['Ada County', 'Canyon County', 'Kootenai County', 'Bonneville County', 'Bannock County'],
            'Illinois': ['Cook County', 'DuPage County', 'Lake County', 'Will County', 'Kane County'],
            'Indiana': ['Marion County', 'Lake County', 'Allen County', 'Hamilton County', 'St. Joseph County'],
            'Iowa': ['Polk County', 'Linn County', 'Scott County', 'Johnson County', 'Black Hawk County'],
            'Kansas': ['Johnson County', 'Sedgwick County', 'Shawnee County', 'Wyandotte County', 'Douglas County'],
            'Kentucky': ['Jefferson County', 'Fayette County', 'Kenton County', 'Boone County', 'Warren County'],
            'Louisiana': ['Orleans Parish', 'East Baton Rouge', 'Jefferson Parish', 'Caddo Parish', 'St. Tammany Parish'],
            'Maine': ['Cumberland County', 'York County', 'Penobscot County', 'Kennebec County', 'Androscoggin County'],
            'Maryland': ['Montgomery County', 'Prince Georges County', 'Baltimore County', 'Anne Arundel County', 'Howard County'],
            'Massachusetts': ['Middlesex County', 'Worcester County', 'Suffolk County', 'Essex County', 'Norfolk County'],
            'Michigan': ['Wayne County', 'Oakland County', 'Macomb County', 'Kent County', 'Genesee County'],
            'Minnesota': ['Hennepin County', 'Ramsey County', 'Dakota County', 'Anoka County', 'Washington County'],
            'Mississippi': ['Hinds County', 'Harrison County', 'DeSoto County', 'Rankin County', 'Jackson County'],
            'Missouri': ['St. Louis County', 'Jackson County', 'St. Charles County', 'Greene County', 'Clay County'],
            'Montana': ['Yellowstone County', 'Missoula County', 'Gallatin County', 'Flathead County', 'Cascade County'],
            'Nebraska': ['Douglas County', 'Lancaster County', 'Sarpy County', 'Hall County', 'Buffalo County'],
            'Nevada': ['Clark County', 'Washoe County', 'Carson City', 'Elko County', 'Douglas County'],
            'New Hampshire': ['Hillsborough County', 'Rockingham County', 'Merrimack County', 'Strafford County', 'Grafton County'],
            'New Jersey': ['Bergen County', 'Middlesex County', 'Essex County', 'Hudson County', 'Monmouth County'],
            'New Mexico': ['Bernalillo County', 'Dona Ana County', 'Santa Fe County', 'Sandoval County', 'San Juan County'],
            'New York': ['Kings County', 'Queens County', 'New York County', 'Suffolk County', 'Bronx County', 'Nassau County'],
            'North Carolina': ['Mecklenburg County', 'Wake County', 'Guilford County', 'Forsyth County', 'Durham County'],
            'North Dakota': ['Cass County', 'Burleigh County', 'Grand Forks County', 'Ward County', 'Williams County'],
            'Ohio': ['Franklin County', 'Cuyahoga County', 'Hamilton County', 'Summit County', 'Montgomery County'],
            'Oklahoma': ['Oklahoma County', 'Tulsa County', 'Cleveland County', 'Canadian County', 'Comanche County'],
            'Oregon': ['Multnomah County', 'Washington County', 'Clackamas County', 'Lane County', 'Marion County'],
            'Pennsylvania': ['Philadelphia County', 'Allegheny County', 'Montgomery County', 'Bucks County', 'Delaware County'],
            'Rhode Island': ['Providence County', 'Kent County', 'Washington County', 'Newport County', 'Bristol County'],
            'South Carolina': ['Greenville County', 'Richland County', 'Charleston County', 'Horry County', 'Spartanburg County'],
            'South Dakota': ['Minnehaha County', 'Pennington County', 'Lincoln County', 'Brown County', 'Brookings County'],
            'Tennessee': ['Shelby County', 'Davidson County', 'Knox County', 'Hamilton County', 'Rutherford County'],
            'Texas': ['Harris County', 'Dallas County', 'Tarrant County', 'Bexar County', 'Travis County', 'Collin County'],
            'Utah': ['Salt Lake County', 'Utah County', 'Davis County', 'Weber County', 'Washington County'],
            'Vermont': ['Chittenden County', 'Rutland County', 'Washington County', 'Windsor County', 'Addison County'],
            'Virginia': ['Fairfax County', 'Prince William County', 'Virginia Beach City', 'Loudoun County', 'Chesterfield County'],
            'Washington': ['King County', 'Pierce County', 'Snohomish County', 'Spokane County', 'Clark County'],
            'West Virginia': ['Kanawha County', 'Berkeley County', 'Cabell County', 'Monongalia County', 'Wood County'],
            'Wisconsin': ['Milwaukee County', 'Dane County', 'Waukesha County', 'Brown County', 'Racine County'],
            'Wyoming': ['Laramie County', 'Natrona County', 'Campbell County', 'Sweetwater County', 'Fremont County']
        };

        // Caribbean countries with real parishes/districts
        const caribbean = {
            'Jamaica': { flag: 'üáØüá≤', parishes: ['Kingston', 'St. Andrew', 'St. Thomas', 'Portland', 'St. Mary', 'St. Ann', 'Trelawny', 'St. James', 'Hanover', 'Westmoreland', 'St. Elizabeth', 'Manchester', 'Clarendon', 'St. Catherine'] },
            'Bahamas': { flag: 'üáßüá∏', parishes: ['New Providence', 'Grand Bahama', 'Abaco', 'Andros', 'Eleuthera', 'Exuma', 'Long Island', 'Cat Island', 'San Salvador', 'Bimini'] },
            'Barbados': { flag: 'üáßüáß', parishes: ['Christ Church', 'St. Andrew', 'St. George', 'St. James', 'St. John', 'St. Joseph', 'St. Lucy', 'St. Michael', 'St. Peter', 'St. Philip', 'St. Thomas'] },
            'Trinidad and Tobago': { flag: 'üáπüáπ', parishes: ['Port of Spain', 'San Fernando', 'Arima', 'Chaguanas', 'Point Fortin', 'Diego Martin', 'San Juan-Laventille', 'Tunapuna-Piarco', 'Couva-Tabaquite-Talparo', 'Sangre Grande', 'Princes Town', 'Penal-Debe', 'Siparia', 'Mayaro-Rio Claro', 'Tobago'] },
            'Puerto Rico': { flag: 'üáµüá∑', parishes: ['San Juan', 'Bayam√≥n', 'Carolina', 'Ponce', 'Caguas', 'Guaynabo', 'Mayag√ºez', 'Arecibo', 'Fajardo', 'Humacao'] },
            'Dominican Republic': { flag: 'üá©üá¥', parishes: ['Santo Domingo', 'Santiago', 'La Romana', 'San Pedro de Macor√≠s', 'Puerto Plata', 'La Vega', 'San Crist√≥bal', 'Hig√ºey', 'Moca', 'Bonao'] },
            'Haiti': { flag: 'üá≠üáπ', parishes: ['Ouest', 'Nord', 'Sud', 'Artibonite', 'Centre', 'Nord-Est', 'Nord-Ouest', 'Sud-Est', 'Grande-Anse', 'Nippes'] },
            'Cuba': { flag: 'üá®üá∫', parishes: ['La Habana', 'Santiago de Cuba', 'Holgu√≠n', 'Camag√ºey', 'Santa Clara', 'Guant√°namo', 'Bayamo', 'Las Tunas', 'Cienfuegos', 'Pinar del R√≠o'] },
            'Cayman Islands': { flag: 'üá∞üáæ', parishes: ['George Town', 'West Bay', 'Bodden Town', 'North Side', 'East End', 'Sister Islands'] },
            'Aruba': { flag: 'üá¶üáº', parishes: ['Oranjestad', 'San Nicolas', 'Noord', 'Santa Cruz', 'Savaneta', 'Paradera'] },
            'Cura√ßao': { flag: 'üá®üáº', parishes: ['Willemstad', 'Barber', 'Banda Abou', 'Banda Ariba'] },
            'St. Lucia': { flag: 'üá±üá®', parishes: ['Castries', 'Gros Islet', 'Vieux Fort', 'Soufri√®re', 'Micoud', 'Dennery', 'Laborie', 'Choiseul', 'Anse la Raye', 'Canaries'] },
            'Grenada': { flag: 'üá¨üá©', parishes: ['St. George', 'St. Andrew', 'St. David', 'St. John', 'St. Mark', 'St. Patrick', 'Carriacou'] },
            'Antigua and Barbuda': { flag: 'üá¶üá¨', parishes: ['St. John', 'St. Mary', 'St. Paul', 'St. Peter', 'St. Philip', 'St. George', 'Barbuda', 'Redonda'] },
            'U.S. Virgin Islands': { flag: 'üáªüáÆ', parishes: ['St. Thomas', 'St. Croix', 'St. John'] }
        };

        let locationDropdownOpen = false;
        let locationLevel = 'main'; // 'main', 'us-counties', 'caribbean-parishes'
        let selectedRegion = null;

        function toggleLocationDropdown() {
            locationDropdownOpen = !locationDropdownOpen;
            const dropdown = document.getElementById('location-dropdown');
            const btn = document.getElementById('location-btn');
            
            if (locationDropdownOpen) {
                dropdown.classList.add('open');
                btn.classList.add('active');
                renderLocationContent();
            } else {
                dropdown.classList.remove('open');
                btn.classList.remove('active');
                locationLevel = 'main';
                selectedRegion = null;
            }
        }

        function renderLocationContent() {
            const content = document.getElementById('location-content');
            
            if (locationLevel === 'main') {
                const statesList = Object.keys(usStates).sort().map(state => 
                    `<button class="location-item" onclick="selectUSState('${state}')">${state}<span class="arrow">‚Üí</span></button>`
                ).join('');
                
                const caribbeanList = Object.entries(caribbean).map(([country, data]) =>
                    `<button class="location-item country" onclick="selectCaribbeanCountry('${country}')"><span><span class="flag">${data.flag}</span>${country}</span><span class="arrow">‚Üí</span></button>`
                ).join('');
                
                content.innerHTML = `
                    <div class="location-header">
                        <h4>üìç Select Location</h4>
                    </div>
                    <div class="location-section-title">üá∫üá∏ United States</div>
                    ${statesList}
                    <div class="location-divider"></div>
                    <div class="location-section-title">üå¥ Caribbean</div>
                    ${caribbeanList}
                `;
            } else if (locationLevel === 'us-counties') {
                const counties = usStates[selectedRegion] || [];
                const countiesList = counties.map(county =>
                    `<button class="location-item" onclick="selectLocation('${county}', '${selectedRegion}')">${county}</button>`
                ).join('');
                
                content.innerHTML = `
                    <div class="location-header">
                        <h4>üìç ${selectedRegion}</h4>
                        <button class="location-back" onclick="goBackToMain()">‚Üê Back</button>
                    </div>
                    <div class="location-section-title">Counties</div>
                    ${countiesList}
                `;
            } else if (locationLevel === 'caribbean-parishes') {
                const countryData = caribbean[selectedRegion];
                const parishes = countryData ? countryData.parishes : [];
                const parishesList = parishes.map(parish =>
                    `<button class="location-item" onclick="selectLocation('${parish}', '${selectedRegion}')">${parish}</button>`
                ).join('');
                
                content.innerHTML = `
                    <div class="location-header">
                        <h4>${countryData?.flag || ''} ${selectedRegion}</h4>
                        <button class="location-back" onclick="goBackToMain()">‚Üê Back</button>
                    </div>
                    <div class="location-section-title">Parishes / Districts</div>
                    ${parishesList}
                `;
            }
        }

        function selectUSState(state) {
            locationLevel = 'us-counties';
            selectedRegion = state;
            renderLocationContent();
        }

        function selectCaribbeanCountry(country) {
            locationLevel = 'caribbean-parishes';
            selectedRegion = country;
            renderLocationContent();
        }

        function goBackToMain() {
            locationLevel = 'main';
            selectedRegion = null;
            renderLocationContent();
        }

        function selectLocation(locality, region) {
            // Determine search type based on active category
            const searchType = activeCategory === 'properties' || activeCategory === 'land' ? 'homes' : 'cars';
            const searchText = `${searchType} in ${locality}, ${region}`;
            
            // Auto-fill search bar
            document.getElementById('search-input').value = searchText;
            
            // Close dropdown
            toggleLocationDropdown();
            
            // Trigger search
            handleSearch(searchText);
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            const picker = document.querySelector('.location-picker');
            if (picker && !picker.contains(e.target) && locationDropdownOpen) {
                toggleLocationDropdown();
            }
        });

        // ===== AUCTION SYSTEM =====
        
        // Auction state
        const auctionState = {
            a1: { currentBid: 8200, timeLeft: 127, ended: false, bids: [
                { bidder: 'Mike', amount: 8200, time: '02:14' },
                { bidder: 'Sarah', amount: 7800, time: '02:18' },
                { bidder: 'John', amount: 7500, time: '02:25' }
            ]},
            a2: { currentBid: 245000, timeLeft: 4523, ended: false, bids: [
                { bidder: 'David', amount: 245000, time: '01:15' },
                { bidder: 'Emma', amount: 242000, time: '01:22' },
                { bidder: 'James', amount: 240000, time: '01:30' }
            ]},
            a3: { currentBid: 15800, timeLeft: 67, ended: false, bids: [
                { bidder: 'Lisa', amount: 15800, time: '00:31' },
                { bidder: 'Tom', amount: 15200, time: '00:45' },
                { bidder: 'Anna', amount: 14800, time: '00:52' }
            ]}
        };

        const bidderNames = ['Alex', 'Jordan', 'Chris', 'Taylor', 'Morgan', 'Casey', 'Riley', 'Quinn', 'Avery', 'Blake'];
        let auctionInterval = null;
        let bidInterval = null;
        let currentBidAuction = null;

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function formatTimeShort(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function formatCurrency(amount) {
            return '$' + amount.toLocaleString();
        }

        function renderAuctions() {
            const grid = document.getElementById('listings-grid');
            const auctionListings = listings.auctions || [];
            
            grid.innerHTML = `<div class="auction-grid" id="auction-grid">
                ${auctionListings.map(auction => {
                    const state = auctionState[auction.id];
                    return `
                        <div class="auction-card ${state.ended ? 'ended' : ''}" id="auction-${auction.id}">
                            <div class="auction-image-container">
                                <img src="${auction.image}" alt="${auction.title}" class="auction-image" />
                                <div class="auction-live-badge ${state.ended ? 'sold' : ''}" id="badge-${auction.id}">
                                    ${state.ended ? 'üèÜ SOLD!' : '<span class="live-dot"></span> LIVE'}
                                </div>
                            </div>
                            <div class="auction-content">
                                <h3 class="auction-title">${auction.title}</h3>
                                <div class="auction-timer ${state.ended ? 'ended' : ''}" id="timer-${auction.id}">
                                    <div class="timer-label ${state.ended ? 'ended' : ''}">${state.ended ? 'Final Price' : 'Ends in'}</div>
                                    <div class="timer-countdown ${state.ended ? 'ended' : ''}" id="countdown-${auction.id}">
                                        ${state.ended ? formatCurrency(state.currentBid) : formatTime(state.timeLeft)}
                                    </div>
                                </div>
                                <div class="auction-current-bid">
                                    <span class="current-bid-label">${state.ended ? 'Sold for' : 'Current Bid'}</span>
                                    <span class="current-bid-amount" id="bid-${auction.id}">${formatCurrency(state.currentBid)}</span>
                                </div>
                                <div class="bid-log" id="log-${auction.id}">
                                    ${state.bids.map((bid, i) => `
                                        <div class="bid-entry ${i === 0 ? 'new' : ''}">
                                            <span class="bidder">${bid.bidder}</span> bid 
                                            <span class="amount">${formatCurrency(bid.amount)}</span> 
                                            at ${bid.time}
                                        </div>
                                    `).join('')}
                                </div>
                                <button class="place-bid-btn" id="btn-${auction.id}" 
                                    onclick="openBidModal('${auction.id}', '${auction.title}')"
                                    ${state.ended ? 'disabled' : ''}>
                                    ${state.ended ? 'üèÜ Auction Ended' : 'üî• Place Bid'}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>`;
            
            startAuctionTimers();
            startAutoBids();
        }

        function startAuctionTimers() {
            if (auctionInterval) clearInterval(auctionInterval);
            
            auctionInterval = setInterval(() => {
                Object.keys(auctionState).forEach(id => {
                    const state = auctionState[id];
                    if (!state.ended && state.timeLeft > 0) {
                        state.timeLeft--;
                        const countdownEl = document.getElementById(`countdown-${id}`);
                        if (countdownEl) {
                            countdownEl.textContent = formatTime(state.timeLeft);
                        }
                        
                        if (state.timeLeft === 0) {
                            endAuction(id);
                        }
                    }
                });
            }, 1000);
        }

        function startAutoBids() {
            if (bidInterval) clearInterval(bidInterval);
            
            bidInterval = setInterval(() => {
                // Pick a random active auction
                const activeAuctions = Object.keys(auctionState).filter(id => !auctionState[id].ended);
                if (activeAuctions.length === 0) return;
                
                const randomId = activeAuctions[Math.floor(Math.random() * activeAuctions.length)];
                const state = auctionState[randomId];
                
                // Add random bid
                const bidIncrement = Math.floor(Math.random() * 500) + 100;
                state.currentBid += bidIncrement;
                const bidder = bidderNames[Math.floor(Math.random() * bidderNames.length)];
                const timeStr = formatTimeShort(state.timeLeft);
                
                state.bids.unshift({ bidder, amount: state.currentBid, time: timeStr });
                if (state.bids.length > 10) state.bids.pop();
                
                // Update UI
                const bidEl = document.getElementById(`bid-${randomId}`);
                if (bidEl) bidEl.textContent = formatCurrency(state.currentBid);
                
                const logEl = document.getElementById(`log-${randomId}`);
                if (logEl) {
                    logEl.innerHTML = state.bids.map((bid, i) => `
                        <div class="bid-entry ${i === 0 ? 'new' : ''}">
                            <span class="bidder">${bid.bidder}</span> bid 
                            <span class="amount">${formatCurrency(bid.amount)}</span> 
                            at ${bid.time}
                        </div>
                    `).join('');
                }
            }, 5000);
        }

        function endAuction(id) {
            const state = auctionState[id];
            state.ended = true;
            
            // Update UI
            const card = document.getElementById(`auction-${id}`);
            if (card) card.classList.add('ended');
            
            const badge = document.getElementById(`badge-${id}`);
            if (badge) {
                badge.classList.add('sold');
                badge.innerHTML = 'üèÜ SOLD!';
            }
            
            const timer = document.getElementById(`timer-${id}`);
            if (timer) timer.classList.add('ended');
            
            const label = timer?.querySelector('.timer-label');
            if (label) {
                label.classList.add('ended');
                label.textContent = 'Final Price';
            }
            
            const countdown = document.getElementById(`countdown-${id}`);
            if (countdown) {
                countdown.classList.add('ended');
                countdown.textContent = formatCurrency(state.currentBid);
            }
            
            const btn = document.getElementById(`btn-${id}`);
            if (btn) {
                btn.disabled = true;
                btn.textContent = 'üèÜ Auction Ended';
            }
            
            // Trigger confetti!
            triggerConfetti();
        }

        function triggerConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';
            document.body.appendChild(container);
            
            const colors = ['#fbbf24', '#ef4444', '#10b981', '#3b82f6', '#8b5cf6', '#f97316'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.remove(), 5000);
        }

        function openBidModal(auctionId, title) {
            currentBidAuction = auctionId;
            const state = auctionState[auctionId];
            const minBid = state.currentBid + 100;
            
            document.getElementById('bid-modal-title').textContent = `Bid on: ${title}`;
            document.getElementById('bid-min-amount').textContent = formatCurrency(minBid);
            document.getElementById('bid-amount-input').value = minBid;
            document.getElementById('bid-amount-input').min = minBid;
            
            openModal('bid');
        }

        function submitBid() {
            const amount = parseInt(document.getElementById('bid-amount-input').value);
            const state = auctionState[currentBidAuction];
            const minBid = state.currentBid + 100;
            
            if (amount < minBid) {
                alert(`Minimum bid is ${formatCurrency(minBid)}`);
                return;
            }
            
            // Update state
            state.currentBid = amount;
            const timeStr = formatTimeShort(state.timeLeft);
            state.bids.unshift({ bidder: 'You', amount, time: timeStr });
            
            // Update UI
            const bidEl = document.getElementById(`bid-${currentBidAuction}`);
            if (bidEl) bidEl.textContent = formatCurrency(amount);
            
            const logEl = document.getElementById(`log-${currentBidAuction}`);
            if (logEl) {
                logEl.innerHTML = state.bids.map((bid, i) => `
                    <div class="bid-entry ${i === 0 ? 'new' : ''}">
                        <span class="bidder">${bid.bidder}</span> bid 
                        <span class="amount">${formatCurrency(bid.amount)}</span> 
                        at ${bid.time}
                    </div>
                `).join('');
            }
            
            closeModal('bid');
            alert('üéâ Your bid has been accepted!\n\nYou are now the highest bidder.');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initHeroBackground(); // Set random hero background photo
            initTicker(); // Initialize ticker bar
            updateProBadge();
            updateLoginUI();
            buildSidebar();
            restoreSidebarState(); // Restore collapsed state
            checkStripeSuccess(); // Check for Stripe payment success
            
            // Check if already logged in as admin and on #admin hash
            if (window.location.hash === '#admin' && localStorage.getItem('admin') === 'true') {
                showAdminPanel();
            }
            updateCompareBar(); // Restore compare items from localStorage
            initOnlineStatus(); // Initialize online status for Pro users
            renderListings();
        });
    </script>
</body>
</html>
